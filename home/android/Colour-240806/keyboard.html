<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="user-scalable=no" />
	<title></title>
	<link type="text/css" rel="stylesheet" media="all" href="keyboard.css" id="theme_css" />
	<link rel="stylesheet" type="text/css" href="common.css">
	<!-- é¢å¤–çš„é”®ç›˜å¸ƒå±€æ–‡ä»¶layout.js -->
	<script src="layout.js"></script>

	<script>
		var landscape = false, filename = 'keyboard.html';
		var docE = document.documentElement.style;
		var Regex = /[\u4e00-\u9fa5]+/;
		var currentDate = new Date();
		var my = {
			æ—¥æœŸ: currentDate.getDate(),
			show: 1, ii: 0, çŸ­è¯­: [],
			//å¤åˆ¶å•ä¸ªæ±‰å­—åˆ°å‰ªè´´æ¿æ—¶è‡ªåŠ¨æ‰§è¡Œ"åæŸ¥é”®"
			åæŸ¥å‰ªè´´æ¿å•å­—: false,  //true:å¼€å¯ false:å…³é—­
			åº•éƒ¨æ˜¾ç¤º: 2, // 0:å…³é—­ 1:å†œå† 2:ä¸­/En
			ä¸‹æ‹‰è¡¥å…¨ç¼–ç : true,
			ä¸Šä¸‹æ»‘åŠ¨çµæ•åº¦: 50,
			å·¦å³æ»‘åŠ¨çµæ•åº¦: 90,
			äºŒé€‰: ";", ä¸‰é€‰: ",", å››é€‰: ".",
			'é…è‰²': [
				"ğŸ¨", "â‘´å½©", "â‘µMac", "â‘¶é»‘", "â‘·å½©ç™½", "â‘¸ç¯®ç™½",
				"â‘¹ç°ç™½", "â‘ºé»„ç™½", "â‘»ç®€é»‘", "â‘¼ç®€ç™½", "â‘½é»‘ç™½", "â‘¾è°·æ­Œ",
				"â‘¿æ–œçº¹", "â’€æ‹Ÿç‰©", "â’è‹å¢¨", "â’‚å¢¨", "â’ƒMacÂ²", "â’„ç½—æŠ€",
				"â’…ç´ ", "â’†æ·¡é»„", "â’‡ç™½ç´§", "ã‰‘åœ†", "ã‰’", "ã‰“æ— æ¡†",
				"ã‰”ç°", "ã‰•ç™½", "26é»‘", "27å€™é€‰", "28ç«‹ä½“1", "29é”®å¸½",
				"30æ— æ ‡", "31ç«‹ä½“1", "32ç´§å‡‘", "33", "34"
			],
			ç¼–å·: ["â€", "â", "â‚", "âƒ", "â„", "â…", "â†", "â‡", "âˆ"]
		};

		/* timer */
		const REPEAT_RATE = 100;
		const REPEAT_TIMEOUT = 350;
		const MENU_TIMEOUT_KEY = 200;
		const MENU_TIMEOUT_CAND = 350;

		/* key code */
		const KEYCODE_SHIFT = -1;
		const KEYCODE_STATE = -2;
		const KEYCODE_MENU = -3;
		const KEYCODE_SWITCH_number = -10;
		const KEYCODE_SWITCH_english = -11;
		const KEYCODE_SWITCH_number2 = -12;
		const KEYCODE_SWITCH_cands = -33;
		const KEYCODE_Select_Index1 = -101;
		const KEYCODE_Select_Index2 = -102;
		const KEYCODE_Select_Index3 = -103;
		const KEYCODE_SWITCH_ENG = -110;
		const KEYCODE_FanCha = 0x1002F;
		const KEYCODE_CTRL_1 = 0x10031;
		const KEYCODE_CTRL_2 = 0x10032;

		const KEYCODE_DEL = 0x08;
		const KEYCODE_TAB = 0x09;
		const KEYCODE_ENTER = 0x0d;
		const KEYCODE_ESC = 0x1b;
		const KEYCODE_SPACE = 0x20;
		const KEYCODE_DEL_F = 0xff;

		const KEYCODE_CTRL = 0x10000;
		const KEYCODE_SHIFT_KEY = 0x20000;
		const KEYCODE_ALT = 0x40000;

		const KEYCODE_HOME = 0xff50;
		const KEYCODE_END = 0xff57;
		const KEYCODE_LEFT = 0xff51;
		const KEYCODE_UP = 0xff52;
		const KEYCODE_RIGHT = 0xff53;
		const KEYCODE_DOWN = 0xff54;

		const YK_VIRT_ADD = 0x0800002;
		const YK_VIRT_DEL = 0x0800003;

		const CTRL_UP = 0x1ff52;
		const CTRL_DOWN = 0x1ff54;

		function getDataset(e, m) {
			var ret;
			do {
				ret = e.dataset[m];
				if (!ret) e = e.parentElement;
			} while (!ret && e);
			return ret;
		}
		function setDataset(e, m, v) { e.dataset[m] = v; }
		function addClass(e, c) { e.classList.add(c); }
		function removeClass(e, c) { e.classList.remove(c); }
		function $(s) { return document.querySelector(s); }

		/* keyboard layout */
		var Keyboards = {
			english: {
				name: "é»˜è®¤",
				hii: {
					q: '!', w: '@', e: '#', r: '$', t: '%',
					y: '^', u: '&', i: '*', o: '(', p: ')',
					a: '_', s: '-', d: '+', f: '=', g: '|',
					h: 'éŸ³', j: 'é¢‘', k: '{', l: '}',
					"â‡ª": '', z: 'â†¶', x: "æ³¨", c: 'âš', v: 'è¯‘', b: 'â˜‚', n: 'æŠ¥', m: 'å­—'
				},
				shifted: false,
				alt: {
					q: '1', w: '2', e: '3', r: '4', t: '5',
					y: '6', u: '7', i: '8', o: '9', p: '0',
					a: 'æ»¤', s: 'â†–', d: 'â†˜', f: '?', g: 'å',
					h: 'â ', j: 'âœ“', k: '[', l: ']',
					"â‡ª": 'áµ€á´¬á´®', z: '`', x: 'â˜»', c: '~', v: '<',
					b: '>', n: '\'', m: '"', "âŒ«": 'è¡Œ',
					"ä¸­/En": 'M', "12": 'ç¬¦',
					";": '/', ",": '\\', ".": ':', "â¥": 'â˜†'
				},
				upper: {
					q: 'Q', w: 'W', e: 'E', r: 'R', t: 'T',
					y: 'Y', u: 'U', i: 'I', o: 'O', p: 'P',
					a: 'A', s: 'S', d: 'D', f: 'F', g: 'G',
					h: 'H', j: 'J', k: 'K', l: 'L',
					z: 'Z', x: 'X', c: 'C', v: 'V', b: 'B',
					n: 'N', m: 'M'
				},
				key: [
					[{ v: '1', sa: true }, { v: '2', sa: true }, { v: '3', sa: true }, { v: '4', sa: true }, { v: '5', sa: true },
					{ v: '_', h: true, sa: true }, { v: '_', h: true, sa: true }, { v: '_', h: true, sa: true }, { v: '_', h: true, sa: true },
					{ v: '6', sa: true }, { v: '7', sa: true }, { v: '8', sa: true }, { v: '9', sa: true }, { v: '0', sa: true }],
					[{ v: 'q' }, { v: 'w' }, { v: 'e' }, { v: 'r' }, { v: 't' },
					{ v: '7', h: true, s: true }, { v: '8', h: true, s: true }, { v: '9', h: true, s: true }, { v: 'â‡¤', c: KEYCODE_HOME, h: true, s: true },
					{ v: 'y' }, { v: 'u' }, { v: 'i' }, { v: 'o' }, { v: 'p' }],
					[{ v: 'a' }, { v: 's' }, { v: 'd' }, { v: 'f' }, { v: 'g' },
					{ v: '4', h: true, s: true }, { v: '5', h: true, s: true }, { v: '6', h: true, s: true }, { v: 'â‡¥', c: KEYCODE_END, h: true, s: true },
					{ v: 'h' }, { v: 'j' }, { v: 'k' }, { v: 'l' }],
					[{ v: 'â‡ª', c: KEYCODE_SHIFT, r: 1.5, s: true },
					{ v: 'z' }, { v: 'x' }, { v: 'c' }, { v: 'v' },
					{ v: '1', h: true, s: true }, { v: '2', h: true, s: true }, { v: '3', h: true, s: true }, { v: 'â†‘', c: KEYCODE_UP, h: true, s: true },
					{ v: 'b' }, { v: 'n' }, { v: 'm' },
					{ v: 'âŒ«', c: KEYCODE_DEL, r: 1.5, s: true }],
					[
						{ v: 'ä¸­/En', r: 1.5, c: KEYCODE_STATE, s: true },
						{ v: '.', r: 1.1, s: true },
						{ v: ',', r: 1.1, s: true },
						{ v: 'ğ’ğğ€ğ‚ğ„', r: 2.6, c: KEYCODE_SPACE },
						{ v: '0', h: true, s: true }, { v: 'â†', c: KEYCODE_LEFT, h: true, s: true }, { v: 'â†“', c: KEYCODE_DOWN, h: true, s: true }, { v: 'â†’', c: KEYCODE_RIGHT, h: true, s: true },
						{ v: ';', r: 1.1, s: true },
						{ v: '12', r: 1.1, c: KEYCODE_SWITCH_number2, s: true },
						{ v: 'â¥', r: 1.5, c: KEYCODE_ENTER, s: true }]
				]
			},
			number: {
				name: "ç¬¦å·",
				shifted: false,
				hii: { '@': "" },
				alt: {
					"ä¸­æ–‡/En": 'M', "è¿”å›": 'æ•°', ",": '<', ".": '>', "âŒ«": 'è¡Œ'
				},
				upper: {
					"!": "ï¼", "@": "ã€ˆ", "#": "ï¼ƒ", "$": "ï¿¥", "%": "ï¼…",
					"^": "â€¦â€¦", "&": "ã€‰", "*": "Ã—", "(": "ï¼ˆ", ")": "ï¼‰",
					"_": "â€”â€”", "-": "ï¼", "+": "ï¼‹", "=": "ï¼", "|": "ï½œ",
					"\\": "ã€", "[": "ã€", "]": "ã€‘", "{": "ï½›", "}": "ï½",
					"Â·": "â€¢", "\"": "â€œ", "'": 'â€™', ":": "ï¼š", ";": "ï¼›", "/": "ï¼", "?": 'ï¼Ÿ',
					"`": 'â€–', "~": 'ï½', ",": "ï¼Œ", ".": "ã€‚"
				},
				key: [
					[{ v: '1', sa: true }, { v: '2', sa: true }, { v: '3', sa: true }, { v: '4', sa: true }, { v: '5', sa: true },
					{ v: '_', r: 4, h: true, sa: true },
					{ v: '6', sa: true }, { v: '7', sa: true }, { v: '8', sa: true }, { v: '9', sa: true }, { v: '0', sa: true }],
					[{ v: '!' }, { v: '@' }, { v: '#' }, { v: '$' }, { v: '%' },
					{ v: '_', r: 4, h: true, s: true },
					{ v: '^' }, { v: '&' }, { v: '*' }, { v: '(' }, { v: ')' }],
					[{ v: '_' }, { v: '-' }, { v: '+' }, { v: '=' }, { v: '|' },
					{ v: '_', r: 4, h: true, s: true },
					{ v: '\\' }, { v: '[' }, { v: ']' }, { v: '\{' }, { v: '}' }],
					[{ v: 'â‡ª', c: KEYCODE_SHIFT, r: 1.5, s: true },
					{ v: 'Â·' }, { v: '"' }, { v: '\'' }, { v: ':' },
					{ v: '_', r: 4, h: true, s: true },
					{ v: ';' }, { v: '/' }, { v: '?' },
					{ v: 'âŒ«', c: KEYCODE_DEL, r: 1.5, s: true }],
					[{ v: 'ä¸­æ–‡/En', c: KEYCODE_STATE, r: 1.5, s: true },
					{ v: 'â£', r: 1.5, c: KEYCODE_SPACE, s: true },
					{ v: '`' }, { v: '~' },
					{ v: 'â£', r: 4, c: KEYCODE_SPACE, h: true, s: true },
					{ v: ',' }, { v: '.' },
					{ v: 'è¿”å›', r: 1.5, c: KEYCODE_SWITCH_english, s: true },
					{ v: 'â¥', r: 1.5, c: KEYCODE_ENTER, s: true }]
				]
			},
			number2: {
				name: "æ•°å­—",
				shifted: false,
				hii: { ':': "æµ‹" },
				alt: {
					"0": '0x', ",": '<', ".": '>', "âŒ«": 'è¡Œ',
					",": '<', ".": '>', "=": '!', "/": '~', "+": '',
					"-": '_', "1": '{', "2": '^', "3": '}', "4": '(',
					"5": '|', "6": ')', "7": '[', "8": '?', "9": ']',
					"'": '`', ":": '@', "#": ';',
					"ä¸­æ–‡/En": 'M', "è¿”å›": 'ç¬¦'
				},
				key: [
					[{ v: 'TAB', c: KEYCODE_TAB, r: 1.5, sa: true }, { v: 'A', r: 1.4, sa: true },
					{ v: '_', r: 4, h: true, sa: true },
					{ v: 'B', r: 1.4, sa: true }, { v: 'C', r: 1.4, sa: true }, { v: 'D', r: 1.4, sa: true }, { v: 'E', r: 1.4, sa: true }, { v: 'F', r: 1.5, sa: true }],
					[{ v: '+', s: true, r: 1.5 }, { v: '-', s: true, r: 1.4 },
					{ v: '_', r: 4, h: true, s: true },
					{ v: '1', r: 1.4 }, { v: '2', r: 1.4 }, { v: '3', r: 1.4 }, { v: '\'', s: true, r: 1.4 }, { v: '"', s: true, r: 1.5 }],
					[{ v: '*', s: true, r: 1.5 }, { v: '/', s: true, r: 1.4 },
					{ v: '_', r: 4, h: true, s: true },
					{ v: '4', r: 1.4 }, { v: '5', r: 1.4 }, { v: '6', r: 1.4 }, { v: ':', s: true, r: 1.4 }, { v: '&', s: true, r: 1.5 }],
					[{ v: '%', s: true, r: 1.5 }, { v: '=', s: true, r: 1.4 },
					{ v: '_', r: 4, h: true, s: true },
					{ v: '7', r: 1.4 }, { v: '8', r: 1.4 }, { v: '9', r: 1.4 }, { v: '#', s: true, r: 1.4 },
					{ v: 'âŒ«', c: KEYCODE_DEL, r: 1.5, s: true }],
					[{ v: 'ä¸­æ–‡/En', c: KEYCODE_STATE, r: 1.5, s: true },
					{ v: ',', r: 1.4, s: true },
					{ v: 'â£', r: 4, c: KEYCODE_SPACE, h: true, s: true },
					{ v: '.', r: 1.4, s: true },
					{ v: '0', r: 1.4 },
					{ v: 'â£', r: 1.4, c: KEYCODE_SPACE, s: true },
					{ v: 'è¿”å›', r: 1.4, c: KEYCODE_SWITCH_english, s: true },
					{ v: 'â¥', r: 1.5, c: KEYCODE_ENTER, s: true }]
				]
			}
		};
		var Keyboard2 = JSON.parse(JSON.stringify(Keyboards.english));

		function setinit() {
			localStorage.å­—ä½“ = 'false';
			localStorage.ä¸Šæ»‘å¤§å†™ = 'false';
			localStorage.æ¸…çˆ½ = 'false';
			localStorage.é” = 'false';
			localStorage.å€™ç¼–å· = 'false';
			localStorage.æ•°å­—è¡Œ = 'false';
			localStorage.å·¥å…·æ  = 'false';
			localStorage.é€‰é‡é”® = 'false';
			localStorage.å‚ç›´æ‚¬æµ®æ  = 'false';
			localStorage.ç©ºæ ¼æ˜¾ç¤º = 'false';
			localStorage.é•¿æŒ‰å¤§å†™ = 'false';
			localStorage.é…è‰² = "keyboard.css";
			localStorage.å¸ƒå±€ = "0";
			localStorage.init = '1';
		};

		if (localStorage.init === undefined) setinit();

		function getLayout(num, on) {
			localStorage.å¸ƒå±€ = num;
			if (num == '2' || num == '3') my.åŒé”® = 1; else my.åŒé”® = 0;
			if (num > 0) {
				var ENG = layout2(num);
				Keyboards.english2 = JSON.parse(JSON.stringify(Keyboard2));
				Keyboards.english2.key[4][0].v = 'è¿”å›';
				Keyboards.english2.key[4][0].c = KEYCODE_SWITCH_english;
				Keyboards.english2.key[4][1].v = 'ä¸­/En';
				Keyboards.english2.key[4][1].c = KEYCODE_STATE;
				Keyboards.english2.name = ENG.name + "2";
				Keyboards.english = JSON.parse(JSON.stringify(ENG));
			} else
				Keyboards.english = JSON.parse(JSON.stringify(Keyboard2));
			if (on) { editor(false); Render.setKeyboard(Keyboards.english); }
		}
		var å¸ƒå±€ = parseInt(localStorage.getItem('å¸ƒå±€')) || 0;
		getLayout(å¸ƒå±€);

		if (localStorage.æ•°å­—è¡Œ === 'true') docE.setProperty('--æ•°å­—æ ', 'inline-block');
		if (localStorage.å·¥å…·æ  === 'true') docE.setProperty('--å·¥å…·æ ', 'flex');
		if (localStorage.æ¸…çˆ½ === "true") {
			docE.setProperty("--ä¸Šæ ‡å­—ç¬¦è‰²1", "transparent");
			docE.setProperty("--ä¸Šæ ‡å­—ç¬¦è‰²2", "transparent");
		}
		if (localStorage.å­—ä½“ === 'true') {
			docE.setProperty('--å€™é€‰æ å­—ä½“', '600 var(--å€™å­—ä½“å¤§å°) æ±‰å­—å­—ä½“,sans-serif,å¤§å­—é›†');
			docE.setProperty('--ç•Œé¢å­—ä½“', 'var(--ç•Œé¢å­—ä½“å¤§å°) æ±‰å­—å­—ä½“,sans-serif,å¤§å­—é›†');
		}
		var CSS = $('#theme_css');
		if (localStorage.é…è‰² != "keyboard.css") CSS.href = localStorage.é…è‰²;

		bottomText('', my.åº•éƒ¨æ˜¾ç¤º);

		var Tools = [
			{ title: "âš™", tool: "0" },
			{ title: "âŒ¦", tool: "1" },
			{ title: "â", tool: "2" },
			{ title: "â˜‘", supscript: "ç‰¹", tool: "10" },
			{ title: "â˜©", supscript: "âœ‚", tool: "4" },
			{ title: "â", supscript: "é¦–", tool: "12" },
			{ title: "â–£", supscript: "å°¾", tool: "13" },
			{ title: "â™ª", tool: "7" },
			{ title: "ï¼¿", supscript: "â˜˜", tool: "8" },
			{ title: "é€ ", tool: "5" },
			{ title: "ç®€", tool: "6" },
			{ title: "ç¬¦", tool: "3" },
			{ title: "ğŸ™‚", tool: "16" }
		];
		var Tools2 = [
			{ title: "âš™", tool: "0" },
			{ title: "âŒ¦", tool: "1" },
			{ title: "â", tool: "2" },
			{ title: "ç¬¦", tool: "3" },
			{ title: "â˜‘", tool: "10" },
			{ title: "âœ‚", tool: "11" },
			{ title: "â", tool: "12" },
			{ title: "â–£", tool: "13" },
			{ title: "ğŸ¤", tool: "7" }
		];
		var Tools3 = [
			{ title: "Øª", tool: "30" },
			{ title: "ç¬¦", tool: "31" },
			{ title: "ç‰¹", tool: "32" },
			{ title: "åº", tool: "33" },
			{ title: "â¤¶", tool: "34" },
			{ title: "â£", tool: "35" },
			{ title: "âŒ«", tool: "36" },
			{ title: "âš¿", tool: "37" },
			{ title: "è¿”", tool: "38" }
		];

		/* draw the keyboard to screen */
		var Render = (function () {
			var _ime, _layout, _code = {}, _cand = [], _page;
			var _state = 0, _select = -1, _tips = false, _hint = false;
			var _menuKey, _candidatePanel, _codePanel, _windowWidth;

			function addtool() {
				var addbutton = [];
				var name = ["å…¨é€‰", "å‰ªåˆ‡", "å¤åˆ¶", "ç²˜è´´", "è¡Œé¦–", "è¡Œå°¾", "é€‰è¡Œ"];
				var tool = [
					"App.action('selectAll')", "App.action('cut')",
					"App.action('copy')", "App.action('paste')",
					"App.key(KEYCODE_HOME)", "App.key(KEYCODE_END)",
					"Render.sel2del(false)"];
				for (var i = 0; i < 7; i++) {
					addbutton.push(`<button ontouchstart="${tool[i]}">${name[i]}</button>`);
				}
				return addbutton.join('');
			}

			function alt2hii(label) {
				if (label == "M") return KEYCODE_MENU;
				else if (label == "â†‘") return KEYCODE_UP;
				else if (label == "â†“") return KEYCODE_DOWN;
				else if (label == "â†") return KEYCODE_LEFT;
				else if (label == "â†’") return KEYCODE_RIGHT;
				else if (label == "â†–") return App.commit("$IMKEY(CTRL_UP)");
				else if (label == "â†˜") return App.commit("$IMKEY(CTRL_DOWN)");
				else if (label == "áµ€á´¬á´®") return KEYCODE_TAB;
				else if (label == "á´‡ğ¬ğœ") return KEYCODE_ESC;
				else if (label == "â ") return App.commit("$TAB(2)");
				else if (label == "é€ ") return YK_VIRT_ADD;
				else if (label == "åˆ ") return YK_VIRT_DEL;
				else if (label == "å") return KEYCODE_FanCha;
				else if (label == "ç¬¦") return Render.setKeyboard(Keyboards.number);
				else if (label == "æ•°") return Render.setKeyboard(Keyboards.number2);
				else if (label == "â") return App.action("copy");
				else if (label == "â–£") return App.action("paste");
				else if (label == "âœ‚") return App.action("cut");
				else if (label == "â˜‘") return App.action("selectAll");
				else if (label == "â†¶") return App.action("undo");
				else if (label == "âœ“") return Render.sel2del(false);
				else if (label == "è¡Œ") return Render.sel2del(true);
				else if (label == "áƒ¦") return overlay("mymy", 1);
				else if (label == "â˜»") return emoji(0);
				else if (label == "â›¬") return emoji(2);
				else if (label == "â˜©") return editor(0);
				else if (label == "á¶œ") return App.commit("$IMKEY(CTRL_0)");
				else if (label == "é¢‘") {
					var G = "IM";
					var K = "auto_move";
					iniGet(G, K)
						.then(data => {
							var è°ƒé¢‘ = (data == '1') ? 0 : 1;
							alert("è‡ªåŠ¨è°ƒé¢‘ å·²" + (è°ƒé¢‘ ? "å¼€å¯" : "å…³é—­"));
							iniSet(G, K, è°ƒé¢‘);
						});
					return;
				}
				else if (label == "éŸ³") {
					var G = "android";
					var K = "android_click_sound";
					iniGet(G, K)
						.then(data => {
							var éŸ³æ•ˆ = (data == '1') ? 0 : 1;
							alert("æŒ‰é”®éŸ³æ•ˆ å·²" + (éŸ³æ•ˆ ? "å¼€å¯" : "å…³é—­"));
							iniSet(G, K, éŸ³æ•ˆ);
						});
					return;
				}
				else if (label == "æ³¨") {
					var G = "IM";
					var K = "key_desc";
					iniGet(G, K)
						.then(data => {
							var é¢å¤–;
							if (!data)
								é¢å¤– = "mb/desc.txt"; //æ–‡ä»¶åœ¨mbç›®å½•
							else
								é¢å¤– = "";
							alert("é¢å¤–æ˜¾ç¤º å·²" + (data ? "å…³é—­" : "å¼€å¯"));
							iniSet(G, K, é¢å¤–);
						});
					return;
				}
				else if (label == "æ»¤") {
					var G = "IM";
					var K = "filter";
					iniGet(G, K)
						.then(data => {
							var è¿‡æ»¤ = (data == "1,1") ? 0 : "1,1";
							alert("è¿‡æ»¤ å·²" + (è¿‡æ»¤ ? "å¼€å¯" : "å…³é—­"));
							iniSet(G, K, è¿‡æ»¤);
						});
					return;
				}
				else if (label == "â½Â²â¶â¾") {
					my.åŒé”® = 2;
					App.key(KEYCODE_CTRL_2);
					Render.setKeyboard(Keyboards.english2);
					return;
				}
				else if (label == "â˜˜") {
					overlay("phrase", 0);
					return;
				}
				else if (label == "æµ‹") {
					if (my.num) {
						App.text(my.num);
						App.key(27);
						my.num = '';
					}
					return;
				}
				else if (label == "ç©º") {
					Render.showMenu([
						{
							text: 'æ¸…ç©ºå‰ªè´´æ¿', click: function () {
								overlay("clipboard", false);
								localStorage.removeItem('clipboard');
								localStorage.removeItem('firstclip');
								alert("å·²æ¸…ç©ºå‰ªè´´æ¿");
							}
						},
					]); return;
				}
				else if (label == "âš") {
					overlay("msgbox", 0); return;
				}
				else if (label == "â˜†") {
					if (['å†…ç ', 'äº‘ç«¯'].indexOf(document.title) >= 0) {
						alert('æ²¡æœ‰å¯ç”¨æ“ä½œ');
					} else if (Render.getSelect() >= 0) {
						alert('æ²¡æœ‰å¯ç”¨æ“ä½œ');
					} else {
						Render.showMenu([
							{ text: 'ğŸ¤', click: App.voice, param: '' },
							{ text: 'âŒ¨', click: App.action, param: "switchInputMethod" },
							{ text: 'åŠ è¯', click: App.key, param: YK_VIRT_ADD },
							{ text: 'åæŸ¥', click: App.key, param: KEYCODE_CTRL | 47 },
						]);
					} return;
				}
				else if (label == "â˜…") {
					Render.showMenu([
						{ text: "ç½‘ç›˜", click: App.commit, param: "$GO(http://sj.ysupan.com/kaikaikai#/p/2227575)" },
						{ text: 'è®ºå›', click: App.commit, param: "$GO(https://yong.dgod.net/index.php?c=thread&fid=2)" },
						{ text: '#', click: App.key, param: 35 },
						{ text: "?", click: App.key, param: 63 },
						{ text: "<>", click: App.commit, param: "<$|>" },
						{ text: "''", click: App.commit, param: "'$|'" },
						{ text: '""', click: App.commit, param: '"$|"' },
						{ text: '()', click: App.commit, param: "($|)" },
						{ text: '[]', click: App.commit, param: "[$|]" },
						{ text: '{}', click: App.commit, param: "{$|}" },
					]);
					return;
				}
				else if (label == "è¯‘") {
					var inputText, check;
					inputText = _cand[_select];
					if (!inputText) {
						if (localStorage.firstclip === undefined) {
							alert("æ‰¾ä¸åˆ°å‰ªè´´æ¿å†…å®¹."); return;
						}
						inputText = localStorage.firstclip;
						check = true;
					} else {
						if (my.index) { inputText = _cand[my.index]; my.index = false; }
						check = false;
					}
					translateText(inputText)
						.then(translation => {
							if (translation) {
								if (!check) Render.addCand(inputText, translation);
								else { localStorage.message = translation; overlay("msgbox", 0); }
							}
						}); return;
				}
				else if (label == "â˜‚") {
					var temp = _cand[_select];
					if (!temp) {
						if (localStorage.firstclip === undefined) temp = "å¹¿å·";
						else temp = localStorage.firstclip;
					}
					else App.key(27);
					var url = "https://api.vvhan.com/api/weather?city=" + temp + "&type=week";
					jianbao(url)
						.then(data => {
							var W = [];
							for (var i = 0; i < 7; i++) {
								W.push(`${data.data[i].date}[${data.data[i].week}]\n${data.data[i].type}ï¼›${data.data[i].low}~${data.data[i].high}ï¼›${data.data[i].fengxiang}:${data.data[i].fengli}`);
							}
							var T = '[' + data.city + ']:\n' + W.join('\n');
							localStorage.message = T; overlay("msgbox", 0);
						}); return;
				}
				else if (label == "æŠ¥") {
					var url = "https://apis.tianapi.com/bulletin/index?key=c5409796738097279ae2c9239e770379";
					jianbao(url)
						.then(data => {
							if (data) {
								var T = data.result.list.map((item, index) => `${index + 1}. ${item.title}`);
								var jb = "ç®€æŠ¥[" + data.result.list[0].mtime + "]:\n" + T.join("\n");
								localStorage.message = jb; overlay("msgbox", 0);
							}
						}); return;
				}
				else if (label == "å­—") {
					var word = _cand[_select];
					if (!word) {
						if (localStorage.firstclip === undefined) return;
						else word = localStorage.firstclip;
					}
					else App.key(27);
					var url = "https://apis.tianapi.com/xhzd/index?key=c5409796738097279ae2c9239e770379&word=" + word.substr(0, 1);
					jianbao(url)
						.then(data => {
							if (data) {
								if (data.result.list[0].wubi == null) data.result.list[0].wubi = "-";
								var zi = "[" + data.result.list[0].hanzi + "]\n" + "æ‹¼éŸ³: " + data.result.list[0].py + "\n" + "äº”ç¬”: " + data.result.list[0].wubi + "\n" + "éƒ¨é¦–: " + data.result.list[0].bushou + "\n" + "ç¬”ç”»: " + data.result.list[0].bihua + "\n" + "éŸ³æ ‡: " + data.result.list[0].pyyb + "\n" + "å­—ä¹‰:\n" + data.result.list[0].content;
								localStorage.message = zi.replace(/<br>/g, '\n'); overlay("msgbox", 0);
							}
						}); return;
				}
				else if (label == "çˆ½") {
					var T1 = getcss(".alt-note", "color");
					if (T1 != "rgba(0, 0, 0, 0)") {
						docE.setProperty("--ä¸Šæ ‡å­—ç¬¦è‰²1", "transparent");
						docE.setProperty("--ä¸Šæ ‡å­—ç¬¦è‰²2", "transparent");
					} else {
						docE.setProperty("--ä¸Šæ ‡å­—ç¬¦è‰²1", "var(--å­—ä½“è‰²1)");
						docE.setProperty("--ä¸Šæ ‡å­—ç¬¦è‰²2", "var(--å­—ä½“è‰²2)");
					} return;
				}
				else if (label == "é‡") {
					var temp = !JSON.parse(localStorage.é€‰é‡é”®);
					localStorage.é€‰é‡é”® = temp;
					alert("é€‰é‡é”® å·²" + (temp ? "å¼€å¯" : "å…³é—­"));
					return;
				}
				else if (label == "ç¼–") {
					var temp = !JSON.parse(localStorage.å€™ç¼–å·);
					localStorage.å€™ç¼–å· = temp;
					alert("å€™é€‰ç¼–å· å·²" + (temp ? "å¼€å¯" : "å…³é—­"));
					return;
				}
				else if (label == "æ‚¬") {
					var temp = !JSON.parse(localStorage.å‚ç›´æ‚¬æµ®æ );
					localStorage.å‚ç›´æ‚¬æµ®æ  = temp;
					alert("å‚ç›´æ‚¬æµ®æ  å·²" + (temp ? "å¼€å¯" : "å…³é—­"));
					return;
				}
				else if (label == "æ˜¾") {
					var temp = !JSON.parse(localStorage.ç©ºæ ¼æ˜¾ç¤º);
					localStorage.ç©ºæ ¼æ˜¾ç¤º = temp;
					alert("ç©ºæ ¼é”®æ˜¾ç¤ºè¾“å…¥æ³•åç§° å·²" + (temp ? "å¼€å¯" : "å…³é—­"));
					return;
				}
				if (label.length != 1) return 0;
				var code = label.charCodeAt(0);
				if (code >= 128) code = 0;
				return code;
			}

			function candtool(tool) {
				if (tool == "0") overlay("theme", 0);
				else if (tool == "1") App.key(KEYCODE_DEL_F);
				else if (tool == "2") overlay("clipboard", 0);
				else if (tool == "3") emoji(1);
				else if (tool == "4") editor(0);
				else if (tool == "5") App.key(YK_VIRT_ADD);
				else if (tool == "6") {
					if (my.é”®ç›˜ === "ç¬¦å·" || my.é”®ç›˜ === "æ•°å­—") return;
					my.s2t = !my.s2t;
					Tools[12].title = (my.s2t ? "ç¹" : "ç®€");
					App.commit("$IMKEY(CTRL_ALT_F)");
					Render.showCandidates([], 0, false);
				}
				else if (tool == "7") App.voice();
				else if (tool == "8") App.hide();
				else if (tool == "10") App.action("selectAll");
				else if (tool == "11") App.action("cut");
				else if (tool == "12") App.action("copy");
				else if (tool == "13") App.action("paste");
				else if (tool == "14") App.action("switchInputMethod");
				else if (tool == "15") App.action("qrcode");
				else if (tool == "16") emoji(0);
				else if (tool == "30") emoji(0, 1);
				else if (tool == "31") emoji(1, 1);
				else if (tool == "32") emoji(2, 1);
				else if (tool == "33") emoji(3, 1);
				else if (tool == "34") App.key(13);
				else if (tool == "35") App.key(32);
				else if (tool == "36") App.key(8);
				else if (tool == "37") {
					localStorage.é” = !JSON.parse(localStorage.é”)
					Render.showToolbar(my.show);
				}
				else if (tool == "38") { my.show = 0; emoji(false); Render.showToolbar(); }
			}

			function addCand(txt, text) {
				_candidatePanel.innerHTML = '';
				var fragment = document.createDocumentFragment();
				var span = document.createElement('span');
				span.textContent = txt + " > " + text;
				setDataset(span, "fanyi", text);
				addClass(span, "first");
				fragment.appendChild(span);
				_candidatePanel.appendChild(fragment);
			}

			function _escapeHTML(str) {
				return str.replace(/[&<>'"]/g, function (tag) {
					const kv = {
						'&': '&amp;',
						'<': '&lt;',
						'>': '&gt;',
						"'": '&#39;',
						'"': '&quot;'
					};
					return kv[tag] || tag
				});
			}

			function _buildKey(label, className, width, dataset, altNote, hii) {
				var altNoteHTML = ''; var hiiHTML = '';
				if (altNote) {
					altNoteHTML = `<div class="alt-note">${altNote}</div>`;
					dataset.push(`data-alt="${_escapeHTML(altNote)}"`);
				}
				if (_layout.shifted) {
					label = _layout.upper[label] || label;
				}
				if (hii) {
					hiiHTML = `<div class="hii-note">${hii}</div>`;
					dataset.push(`data-hii="${_escapeHTML(hii)}"`);
				}
				var content = `<div class="keyboard-key ${className}" ${dataset.join(' ')} style="width: ${width}px">`;
				content += `<span class="visual-wrapper"><span>${label}</span>${altNoteHTML}${hiiHTML}</span></div>`;
				return content;
			}

			function init(keyboard) {
				_ime = $(keyboard);
				if (landscape)
					addClass(document.body, "landscape");
			}

			function getWidth() {
				return _windowWidth;
			}

			function getHeight() {
				return _ime.clientHeight;
			}

			function setKeyboard(layout) {
				my.é”®ç›˜ = layout.name;
				_layout = layout;
				Render.draw();
			}

			function adjustScaleLandscape(v, w, h) {
				if (w > h)
					return v * (16 / 9) / (w / h);
				else
					return v * (16 / 9) / (h / w);
			}

			function draw() {
				var content = '';
				var layoutWidth = _layout.width || 10;
				var totalWidth = _ime.clientWidth;
				var åˆ†éš” = (my.é”®ç›˜ === "é»˜è®¤" || my.é”®ç›˜ === "æ— åˆ†å·" || my.é”®ç›˜ === "æ•°å­—" || my.é”®ç›˜ === "ç¬¦å·") && landscape ? 14 : 10;
				if (my.é”®ç›˜ == "17é”®2" && landscape) åˆ†éš” = 14;
				var placeHolderWidth = (landscape ? (totalWidth - 2) / åˆ†éš” : (totalWidth - 2) / åˆ†éš”);
				if (filename != 'popup.html') {
					docE.setProperty('--èƒŒæ™¯è‰²0', 'var(--é”®ç›˜èƒŒæ™¯è‰²)');
					content += "<div class='keyboard-border-inner'></div>"
				}
				else
					addClass(_ime, 'popup');
				content += "<div class='keyboard-candidate-panel'></div><div class='keyboard-code-panel' style='display:none'></div>";
				if (_layout.key.length > 0) {
					content += '<p class="zg" style="height: .4rem;"></p><div class="adds">' + Render.addtool() + '</div>';
					content += "<div class='keyboard-key-panel'>";
					_layout.key.forEach((function buildKeyboardRow(row, nrow) {
						content += '<div class="keyboard-row">';
						row.forEach((function buildKeyboardColumns(key, ncolumn) {
							if ("h" in key && !landscape) return;
							var keyChar = key.v;
							if (key.c == KEYCODE_STATE) {
								if (document.title.length > 0 && _state == 0)
									keyChar = document.title.charAt(0);
								else
									keyChar = "En";
							}
							if (key.c == KEYCODE_SPACE) {
								if (document.title.length > 0 && _state == 0) {
									if (_layout.alt["l"] && localStorage.ç©ºæ ¼æ˜¾ç¤º === 'true') keyChar = document.title.substr(0, 6);
									else _layout.alt[key.v] = document.title.substr(0, 6);
								} else {
									if (_layout.alt["l"] && localStorage.ç©ºæ ¼æ˜¾ç¤º === 'true') keyChar = "â£";
									else _layout.alt[key.v] = "En";
								}
							}
							var code;
							if ("c" in key) {
								code = key.c;
							} else {
								code = (keyChar.length == 1 ? keyChar.charCodeAt(0) : 0);
								if (code >= 128) code = 0;
							}
							var className = key.sa ? "special-keya" : (key.s ? "special-key" : "");
							if (_layout.shifted && code == KEYCODE_SHIFT)
								if (key.s) className += " kbr-key-active";
							var ratio = key.r || 1;
							if (landscape) {
								switch (key.v) {
									case 'ä¸­/En':
										if (my.é”®ç›˜ == "17é”®2")
											ratio = 1;
										else
											ratio = 1.5;
										break;
									case 'â¥': ratio = 1.5; break;
								}
								switch (key.c) {
									case KEYCODE_SWITCH_number: ratio = 1.5; break;
									case KEYCODE_ENTER: ratio = 1.5; break;
								}
							}
							var keyWidth = placeHolderWidth * ratio;
							var dataset = [
								'data-row="' + nrow + '"',
								'data-column="' + ncolumn + '"',
								'data-keycode="' + code + '"'
							];
							if (keyChar == '"') {
								dataset.push(`data-label='"'`);
							} else {
								dataset.push(`data-label="${keyChar}"`);
							}
							if (key.c == KEYCODE_STATE) {
								dataset.push(`data-state="${key.v}"`);
							}
							content += _buildKey(keyChar, className, keyWidth,
								dataset, _layout.alt[key.v], _layout.hii[key.v]);

						}));
						content += '</div>';
					}));
					if (my.åº•éƒ¨æ˜¾ç¤º == 0) {
						content += `</div><div class="bottom-zg" style="display:inherit"></div>`;
					} else
						content += `</div><div class="bottom-zg" ontouchstart="App.key(KEYCODE_STATE)"><span>${my.æ–‡æœ¬}</span></div>`;
				}
				_ime.innerHTML = content;

				var changeScale;
				// landscape=!window.matchMedia("(orientation: portrait)").matches;
				if (filename == "popup.html") {
					var screenWidth = Math.min(screen.width, screen.height);
					//			changeScale = screenWidth*window.devicePixelRatio/40;
					var PP = window.getComputedStyle(document.documentElement).getPropertyValue("--æ‚¬æµ®æ å®½åº¦");
					App.resize(PP);
					var TT = window.getComputedStyle(document.documentElement).getPropertyValue("--æ‚¬æµ®æ å­—ä½“å¤§å°");
					changeScale = TT;
					_ime.style.width = window.innerWidth + 'px';
				} else {
					if (landscape) {
						changeScale = window.innerWidth / 72;
						changeScale = adjustScaleLandscape(changeScale, screen.width, screen.height);
					} else {
						changeScale = window.innerWidth / 30;
					}
				}
				document.documentElement.style.fontSize = changeScale + 'px';

				_candidatePanel = $('.keyboard-candidate-panel');
				_codePanel = $('.keyboard-code-panel');
				showCandidates(_cand, _select, _page, _tips, _code);
				_ime.style.setProperty("--keyboard-width", getWidth() + 'px');
				_ime.style.setProperty("--keyboard-height", getHeight() + 'px');

				_windowWidth = totalWidth;
				return true;
			}

			function highlightKey(key) {
				var orig = key;
				while (key.nodeName == "SPAN")
					key = key.parentElement;
				if (!key) return;
				if (!getDataset(key, "keycode")) {
					setDataset(orig, "active", "1");
					return;
				}
				if (_hint)
					addClass(key, 'highlighted');
				else
					addClass(key, 'highlighted2');
			}

			function unHighlightKey(key) {
				var orig = key;
				while (key && key.nodeName == "SPAN")
					key = key.parentElement;
				if (!key) return;
				if (!getDataset(key, "keycode")) {
					setDataset(orig, "active", "");
					return;
				}
				if (_hint)
					removeClass(key, 'highlighted');
				else
					removeClass(key, 'highlighted2');
			}

			function setShifted(state) {
				if (_layout.shifted == state)
					return;
				if (state != 'locked')
					_layout.shifted = state;

				var key = $('div[data-keycode="' + KEYCODE_SHIFT + '"]');
				if (!key) return;

				if (state === 'locked') {
					removeClass(key, 'kbr-key-active');
					addClass(key, 'kbr-key-hold');
				} else if (state) {
					addClass(key, 'kbr-key-active');
					removeClass(key, 'kbr-key-hold');
				} else {
					removeClass(key, 'kbr-key-active');
					removeClass(key, 'kbr-key-hold');
				}
				var keys = document.querySelectorAll('.keyboard-key');
				for (var i = 0; i < keys.length; ++i) {
					key = keys[i];
					var label = getDataset(key, "label");
					if (_layout.shifted) label = _layout.upper[label];
					if (label) {
						if (getDataset(key, "keycode") != 32)
							key.querySelector("span > span").textContent = label;
					}
				}
			}

			function isShifted() {
				return _layout.shifted;
			}

			function setState(state, name) {
				var temp = (_state == 1) ? "none" : "uppercase";
				docE.setProperty('--case', temp);
				if (_state == state && document.title == name)
					return;
				if (name) document.title = name;
				_state = state;
				var label, alt;
				if (document.title.length > 0 && _state == 0) {
					label = document.title.substr(0, 1);
					labelsp = document.title.substr(0, 6);
					alt = document.title;
				} else {
					alt = label = "En"; labelsp = "â£";
				}
				var key = $('div[data-keycode="-2"]');
				if (key) {
					setDataset(key, "label", label);
					var ele = key.querySelector('span > span');
					ele.textContent = label.substr(0, 2);
				}
				var sp = $("div[data-keycode='32']");
				if (my.é”®ç›˜ === "ç¬¦å·" || my.é”®ç›˜ === "æ•°å­—") var L = true;
				if (sp) {
					if (localStorage.ç©ºæ ¼æ˜¾ç¤º === 'true' && !L) {
						setDataset(sp, "label", labelsp);
						var ele = sp.querySelector("span > span");
						ele.textContent = labelsp;
					} else {
						setDataset(sp, "alt", alt);
						var ele1 = sp.querySelector("span .alt-note");
						ele1.textContent = alt;
					}
				}
			}

			function getState() {
				return _state;
			}

			function showToolbar(on) {
				var list;
				if (on || on === 0) { list = Tools3; Tools3[7].title = (localStorage.é” === 'true') ? "ğŸ”’" : "âš¿"; }
				else if (!my.tool) list = Tools;
				else list = Tools2;
				_candidatePanel.innerHTML = '';
				var fragment = document.createDocumentFragment();
				for (var i = 0; i < list.length; i++) {
					var span = document.createElement('span');
					if (on === i) span.style.color = "var(--å€™é«˜äº®é¦–é€‰è‰²)";
					span.textContent = list[i].title;
					setDataset(span, "tool", list[i].tool);
					addClass(span, "tool");
					// æ·»åŠ ä¸Šæ ‡
					if (list[i].supscript) {
						var sup = document.createElement('sup');
						sup.textContent = list[i].supscript;
						span.appendChild(sup);
					}
					fragment.appendChild(span);
				}
				_candidatePanel.appendChild(fragment);
			}

			function showCode(code) {
				if (!_codePanel)
					return;
				_codePanel.innerHTML = '';
				if (code && (code.code || code.got)) {
					var s, i, span;
					if (code.got) {
						s = code.got;
						for (i = 0; i < s.length; i++) {
							span = document.createElement('span');
							addClass(span, 'code-got');
							span.textContent = s[i];
							_codePanel.appendChild(span);
						}
					}
					if (code.code) {
						var spans = [];
						s = code.code;
						for (i = 0; i < s.length; i++) {
							span = document.createElement('span');
							addClass(span, 'code-text');
							span.textContent = (s[i] == ' ' ? '\xa0' : s[i]);
							spans.push(span);
						}
						span = document.createElement('span');
						addClass(span, 'code-caret');
						if (code.caret == -1 || code.caret == s.length) {
							spans.push(span);
						} else {
							spans.splice(code.caret, 0, span);
						}
						for (i = 0; i < spans.length; i++)
							_codePanel.appendChild(spans[i]);
					} else {
						span = document.createElement('span');
						addClass(span, 'code-caret');
						_codePanel.appendChild(span);
					}
					_codePanel.style.display = "";
				} else {
					_codePanel.style.display = "none";
				}
				_code = code;
			}

			function showCandidates(candidates, select, page, tips, code) {
				if (!candidates)
					return;
				//		overlay('cands',false);
				_candidatePanel.innerHTML = '';
				showCode(code);
				if (candidates.length > 0) {
					rkey(true);
					var fragment = document.createDocumentFragment();
					var selected;

					candidates.forEach(function buildCandidateEntry(candidate, index) {
						var span = document.createElement('span');
						setDataset(span, "selection", true);
						setDataset(span, "data", select == -1 ? -1 : index);
						if (localStorage.å€™ç¼–å· === "true")
							span.textContent = my.ç¼–å·[index] + candidate;
						else
							span.textContent = candidate;
						var br = document.createElement("br");
						if (filename == "popup.html" && localStorage.å‚ç›´æ‚¬æµ®æ  === 'true' && index > 0) fragment.appendChild(br);
						if (index == select) {
							addClass(span, "first");
							selected = span;
						}
						if (tips && tips[index]) {
							var tipSpan = document.createElement('label'), txt = '';
							addClass(tipSpan, "codetip");
							for (let char of tips[index]) {
								var txtcode = char.charCodeAt(0);
								if (txtcode >= 97 && txtcode <= 122)
									txt += String.fromCodePoint(119737 + txtcode);
								else txt += char;
							}
							tipSpan.textContent = txt;
							span.appendChild(tipSpan);
						}
						fragment.appendChild(span);
					});
					if (page) {
						var span = document.createElement('span');
						setDataset(span, "selection", true);
						setDataset(span, "page", true);
						span.textContent = "â†•";
						fragment.appendChild(span);
						addClass(_candidatePanel, "page");
					} else {
						removeClass(_candidatePanel, "page");
					}
					_candidatePanel.scrollLeft = 0;
					_candidatePanel.appendChild(fragment);
					if (selected) selected.scrollIntoView({ behavior: 'instant' });
					_cand = candidates;
					_page = page;
					_tips = tips;
					_select = select;
					if (!isNaN(_cand[0]) && !isNaN(parseFloat(_cand[0])))
						my.num = code.code.substring(1) + "=" + _cand[0];
					else my.num = "";
					if (code.code.match(Regex)) {
						//				alert(_cand.join(" "));
					}
				} else {
					_cand.length = 0;
					_select = -1;
					removeClass(_candidatePanel, "page");
					showToolbar();
					showMenu();
					rkey(false);
				}
			}

			function rkey(on) {
				my.c1 = on;
				if (my.é”®ç›˜ != "17é”®") ReplaceKey(27, -1, "æ¶ˆ", "â‡ª");
				else ReplaceKey(27, -12, "æ¶ˆ", "12");
				// æœ‰å€™é€‰æ—¶ æ·»åŠ  äºŒä¸‰å››é€‰é‡é”®
				if (localStorage.é€‰é‡é”® === 'true' && my.é”®ç›˜ != "æ•°å­—") {
					ReplaceKey(-101, my.äºŒé€‰.charCodeAt(0), "â‘¡", my.äºŒé€‰);
					ReplaceKey(-102, my.ä¸‰é€‰.charCodeAt(0), "â‘¢", my.ä¸‰é€‰);
					ReplaceKey(-103, my.å››é€‰.charCodeAt(0), "â‘£", my.å››é€‰);
				}
			}

			function ReplaceKey(newkey, oldkey, newname, oldname) {
				var key = $("div[data-keycode='" + newkey + "']") || $("div[data-keycode='" + oldkey + "']");
				if (!key) return;
				var label, keycode;
				if (my.c1) {
					label = newname;
					keycode = newkey;
				} else {
					label = oldname;
					keycode = oldkey;
				}
				setDataset(key, "label", label);
				setDataset(key, "keycode", keycode);
				var ele = key.querySelector("span > span");
				ele.textContent = label.substr(0, 2);
			}

			function sel2del(sd) {
				var Panel = $(".keyboard-code-panel .code-text");
				if (my.c1 || Panel)
					App.key(KEYCODE_ESC);
				else {
					if (sd != 2) App.key(KEYCODE_END);
					App.key(KEYCODE_HOME | KEYCODE_SHIFT_KEY);
					if (sd) App.key(KEYCODE_DEL);
				}
			}

			function changes(ia) {
				my.ii += 1;
				if (my.ti == undefined) my.ti = ia;
				if (my.ti != ia) my.ii = 5;
				var ç¼©æ”¾ = ["100%", "93%", "91%", "88%", "85%"];
				var é—´è· = [.38, .3, .24, .2, .16];
				if (my.ii <= 4) {
					my.ti = ia;
					docE.setProperty('--å€™å·¥å…·é—´è·', é—´è·[my.ii] + "rem");
					docE.setProperty('--å³', "initial");
					docE.setProperty('--é—´', (4.5 - my.ii) / 10 + "rem");
					docE.setProperty('--ç¼©å°', ç¼©æ”¾[my.ii]);
					Render.draw(); editor(false); editor(0);
					if (ia == 1) docE.setProperty('--å³', "0");
					if (ia == 0) docE.setProperty('--å³', "initial");
				} else {
					my.ti = undefined; my.ii = 0;
					docE.setProperty('--é—´', ".4rem");
					docE.setProperty('--å€™å·¥å…·é—´è·', ".38rem");
					docE.setProperty('--ç¼©å°', "100%");
					Render.draw(); editor(false); editor(0);
				}
			}

			function showAlternatives(key) {
				if (!key) return;
				if (_menuKey) hideAlternatives();
				while (key && key.nodeName != 'DIV')
					key = key.parentElement;
				if (!key) return;
				var altChars = getDataset(key, "alt");
				var temp = key.querySelector("span > span")
				if (!altChars || altChars.length < 1 || !temp) return;
				temp.textContent = altChars;
				_menuKey = key;
				addClass(key, 'alt-show');
			}

			function hideAlternatives() {
				var key = _menuKey;
				if (!key) return;
				_menuKey = undefined;
				var label = getDataset(key, "label");
				if (_layout.shifted && _layout.upper[label])
					label = _layout.upper[label];
				var temp = key.querySelector("span > span")
				if (!label || !temp) return;
				temp.textContent = label;
				removeClass(key, 'alt-show');
				if (getDataset(key, "keycode") == 32) Render.draw();
			}

			function getCode(key) {
				var label;
				if (_menuKey) {
					var label = getDataset(key, "alt");
					return Render.alt2hii(label);
				}
				var keyCode = parseInt(getDataset(key, "keycode"));
				if (Render.isShifted()) {
					label = getDataset(key, "label");
					if (_layout.shifted) label = _layout.upper[label];
					if (label) {
						if (label.length == 1) {
							keyCode = label.charCodeAt(0);
							if (keyCode >= 128)
								keyCode = 0;
						} else {
							keyCode = 0;
						}
					}
				}
				return keyCode;
			}

			function getText(key) {
				var label;
				if (_menuKey) {
					label = getDataset(key, "alt");
				} else {
					label = getDataset(key, "label");
					if (_layout.shifted)
						label = _layout.upper[label];
				}
				return label;
			}

			function getSelect() {
				return _select;
			}

			function hint(on) {
				_hint = !_hint;
				if (my.show) { my.show = 0; return; }
				alert("æŒ‰é”®æç¤ºå·²" + (_hint ? "æ‰“å¼€" : "å…³é—­"));
			}

			function showMenu(c) {
				if (!filename.startsWith("keyboard"))
					return;
				var cont = $('.action-shadow');
				if (!c || c.length == 0) {
					cont.style.display = "none";
					return;
				}
				var el = $('.action-shadow .action-menu');
				var arr = [];
				for (var i = 0; i < c.length; i++) {
					var p = c[i];
					if (p.visible === false)
						continue;
					arr.push(`<button class="action-item">${p.text}</button>`);
				}
				el.innerHTML = arr.join('');
				cont.style.height = getHeight() + 'px';
				cont.style.display = "block";
				cont.onclick = function (e) {
					if (e.target == cont) {
						cont.style.display = "none";
						return;
					}
					var text = e.target.textContent;
					e = c.find(e => e.text == text);
					if (e && e.click)
						e.click(e.param);
					setTimeout(Render.showMenu, 100);
				}
			}

			function setSelectIndex(index) {
				if (index < 0 || index === undefined || index >= _cand.length || index == _select)
					return;
				if (index > _select) {
					App.commit(`$IMKEY(DOWN(${index - _select}))`);
				} else {
					App.commit(`$IMKEY(UP(${_select - index}))`);
				}
			}

			return {
				init, setKeyboard, draw, getWidth, getHeight,
				setShifted, isShifted, setState, getState, highlightKey,
				unHighlightKey, showCandidates, showAlternatives,
				showToolbar, hideAlternatives, getCode, getText,
				getSelect, hint, showMenu, setSelectIndex,
				sel2del, changes, addtool, ReplaceKey, alt2hii, candtool, addCand,
			};
		})();

		/* handle mouse or touch screen events */
		var Handler = (function () {
			var _ime;
			var touchCount = 0;
			var touchPresent = false;
			var touchedKeys = {};
			var touchStart = {};
			var touchChanged = {};
			var deleteTimeout;
			var deleteInterval;
			var menuTimeout;
			var delayTimeout;
			var skipKey = false;
			var flick = false;

			function setCurrentKey(value, touchId) {
				touchedKeys[touchId].target = value;
				touchChanged[touchId] = true;
			}

			function setMenuTimeout(target, coords, touchId) {
				if (touchCount > 1)
					return;
				var timeout = MENU_TIMEOUT_KEY;
				if (getDataset(target, "selection") == "true")
					timeout = MENU_TIMEOUT_CAND;
				menuTimeout = setTimeout(function () {
					skipKey = true;
					var keycode = Render.getCode(target);
					if ((keycode >= 97 && keycode <= 122) && localStorage.é•¿æŒ‰å¤§å†™ == 'true') {
						deleteInterval = setTimeout(function () {
							App.key(keycode - 32); my.touch = true;
						}, 200); return;
					}
					Render.showAlternatives(target);
					switch (keycode) {
						case KEYCODE_DEL:
							App.key(keycode);
							deleteTimeout = setTimeout(function () {
								App.key(keycode);
								deleteInterval = setInterval(function () {
									App.key(keycode);
								}, REPEAT_RATE);
							}, REPEAT_TIMEOUT);
							break;
						case KEYCODE_SPACE:
							deleteInterval = setTimeout(function () {
								App.key(KEYCODE_STATE);
								var temp = (Render.getState() == 0) ? "En" : "ä¸­æ–‡";
								alert(temp);
								if (my.é”®ç›˜ === "17é”®" || my.é”®ç›˜ === "14é”®") { Render.setKeyboard(Keyboards.english2); }
							}, 200);
							break;
						default:
							if (!keycode && !touchChanged[touchId]) {
								var index = getDataset(target, "data"); my.index = index;
								if (index >= 0) {
									Render.setSelectIndex(index);
									Render.showMenu([
										{ text: 'ç¼–ç ', click: function () { App.query(index); Render.setSelectIndex(0); } },
										{ text: 'åˆ è¯', click: App.key, param: YK_VIRT_DEL },
										{ text: 'ä¸Šç§»', click: App.key, param: CTRL_UP },
										{ text: 'ä¸‹ç§»', click: App.key, param: CTRL_DOWN },
										{ text: 'ç¿»è¯‘', click: function () { Render.alt2hii("è¯‘"); } },
									]);
								} else if (getDataset(target, "page")) {

								} else if (getDataset(target, "tool") == 0) {
									overlay("setting", 0);
								} else if (getDataset(target, "tool") == 1) {
									Render.alt2hii("çˆ½");
								} else if (getDataset(target, "tool") == 2) {
									Render.alt2hii("ç©º");
								} else if (getDataset(target, "tool") == 3) {
									overlay("mymy", 0);
								} else if (getDataset(target, "tool") == 4) {
									App.action("cut");
								} else if (getDataset(target, "tool") == 5) {
									Render.alt2hii("é‡");
								} else if (getDataset(target, "tool") == 6) {
									Render.alt2hii("æ‚¬");
								} else if (getDataset(target, "tool") == 7) {
									Render.alt2hii("ç¼–");
								} else if (getDataset(target, "tool") == 8) {
									overlay("phrase", 0);
									return;
								} else if (getDataset(target, "tool") == 10) {
									emoji(2);
								} else if (getDataset(target, "tool") == 12) {
									App.key(KEYCODE_SHIFT_KEY | KEYCODE_HOME);
								} else if (getDataset(target, "tool") == 13) {
									App.key(KEYCODE_SHIFT_KEY | KEYCODE_END);
								}
							} else skipKey = false;
							break;
					}
				}, timeout);
			}

			function startPress(target, coords, touchId) {
				touchStart[touchId] = Date.now();
				touchChanged[touchId] = false;
				skipKey = false;
				App.feedback();
				setMenuTimeout(target, coords, touchId);
				Render.highlightKey(target);
			}

			function movePress(target, coords, touchId) {
				var oldTarget = touchedKeys[touchId].target;
				if (!target || !oldTarget || oldTarget == target)
					return;
				if (target == oldTarget.parentElement)
					return;
				Render.hideAlternatives();
				Render.unHighlightKey(oldTarget);
				Render.highlightKey(target);
				setCurrentKey(target, touchId);

				clearTimeout(deleteTimeout);
				clearInterval(deleteInterval);
				clearTimeout(menuTimeout);
				var keycode = Render.getCode(target);
				if (keycode != KEYCODE_DEL)
					setMenuTimeout(target, coords, touchId);
			}

			function endPress(target, coords, touchId) {
				clearTimeout(deleteTimeout);
				clearInterval(deleteInterval);
				clearTimeout(menuTimeout);
				if (!target) return;
				var getDate = new Date().getDate();
				if (my.æ—¥æœŸ != getDate) {
					bottomText(1, my.åº•éƒ¨æ˜¾ç¤º);
					my.æ—¥æœŸ = getDate;
				}
				if (getDataset(target, "selection")) {
					if (!skipKey) {
						if ($("#keyboard-overlay")) {
							overlay(false);
							Render.unHighlightKey(target);
							return;
						}
						var page = getDataset(target, "page");
						if (page) {
							App.cands(); //App.page();
						} else {
							var index = getDataset(target, "data");
							if (index == -1) {
								App.text(target.textContent);
								Render.showCandidates([], 0, false);
							}
							else if (!touchChanged[touchId] && !skipKey) {
								App.select(index);
							}
						}
					}
				} else if (getDataset(target, "fanyi")) {
					if (!skipKey) {
						var fanyi = getDataset(target, "fanyi");
						App.text(fanyi);
						App.key(27);
						Render.showCandidates([], 0, false);
					}
				} else if (getDataset(target, "tool")) {
					if (!skipKey) {
						var tool = getDataset(target, "tool");
						Render.candtool(tool);
					}
				} else if (!skipKey) {
					var keyCode = Render.getCode(target);
					switch (keyCode) {
						case 0:
							App.text(Render.getText(target));
							break;
						case KEYCODE_Select_Index1:
							App.select(1);
							break;
						case KEYCODE_Select_Index2:
							App.select(2);
							break;
						case KEYCODE_Select_Index3:
							App.select(3);
							break;
						case KEYCODE_SWITCH_cands:
							App.cands();
							break;
						case KEYCODE_SHIFT:
							if (my.é”®ç›˜ === "ç¬¦å·") var k = true;
							if (Render.isShifted() && my.shl && !k) {
								Render.setShifted('locked'); my.shl = false;
							}
							else if (!Render.isShifted()) {
								Render.setShifted(true); my.shl = true;
							}
							else { Render.setShifted(false); my.shl = false; }
							break;
						case KEYCODE_SWITCH_number:
							Render.setKeyboard(Keyboards.number);
							break;
						case KEYCODE_SWITCH_number2:
							Render.setKeyboard(Keyboards.number2);
							break;
						case KEYCODE_SWITCH_ENG:
							Render.setKeyboard(Keyboards.english2);
							break;
						case KEYCODE_SWITCH_english:
							if (my.åŒé”® === 1 && Render.getState() == 1) App.key(-2);
							Render.setKeyboard(Keyboards.english);
							if (my.åŒé”® > 1) { App.key(KEYCODE_CTRL_1); my.åŒé”® = 1; }
							break;
						default:
							if (keyCode) App.key(keyCode);
							if (my.shl) Render.setShifted(false);
							break;
					}
				}
				var diff = Date.now() - touchStart[touchId];
				if (diff >= 0 && diff < 15) {
					delayTimeout = setTimeout(function () {
						Render.hideAlternatives();
						Render.unHighlightKey(target);
						delayTimeout = undefined;
					}, 200 - diff);
				} else {
					Render.hideAlternatives();
					Render.unHighlightKey(target);
				}
			}

			function handleTouches(evt, callback) {
				for (var i = 0; i < evt.changedTouches.length; i++) {
					var touch = evt.changedTouches[i];
					var touchId = touch.identifier;
					callback(touch, touchId);
				}
			}

			function onTouchStart(evt) {
				touchPresent = true;
				touchCount = evt.touches.length;
				handleTouches(evt, function handleTouchStart(touch, touchId) {
					var target = touch.target;
					target.addEventListener('touchmove', onTouchMove);
					target.addEventListener('touchend', onTouchEnd);
					target.addEventListener('touchcancel', onTouchEnd);
					touchedKeys[touchId] = { target: target, x: touch.pageX, y: touch.pageY };
					startPress(target, touch, touchId);
				});
			}

			function onTouchMove(evt) {
				handleTouches(evt, function handleTouchMove(touch, touchId) {
					var tk = touchedKeys[touchId];
					var x = Math.abs(tk.x - touch.pageX);
					var y = Math.abs(tk.y - touch.pageY);
					if (x < 5 && y < 5) return;
					var key = getDataset(touch.target, "keycode");
					if (key) {
						if (y > my.ä¸Šä¸‹æ»‘åŠ¨çµæ•åº¦ && x < 90) flick = (tk.y > touch.pageY) ? 1 : 2;
						else if (x > my.å·¦å³æ»‘åŠ¨çµæ•åº¦) flick = (tk.x > touch.pageX) ? 3 : 4;
					} else {
						skipKey = true;
						touchChanged[touchId] = true;
						touchedKeys[touchId].x = touch.pageX;
						touchedKeys[touchId].y = touch.pageY;
						var target = document.elementFromPoint(touch.pageX, touch.pageY);
						movePress(target, touch, touchId);
					}
				});
			}

			function onTouchEnd(evt) {
				touchCount = evt.touches.length;

				handleTouches(evt, function handleTouchEnd(touch, touchId) {
					if (!touchedKeys[touchId])
						return;
					var target = touch.target;
					target.removeEventListener('touchmove', onTouchMove);
					target.removeEventListener('touchend', onTouchEnd);
					target.removeEventListener('touchcancel', onTouchEnd);
					if (flick) flickkey(target);
					flick = false;
					endPress(touchedKeys[touchId].target, touch, touchId);
					delete touchedKeys[touchId];
				});
			}

			function flickkey(target) {
				if (my.touch) { my.touch = false; return; }
				skipKey = true;
				var key = getDataset(target, "keycode");
				switch (flick) {
					case 2:
						if (key == 8) App.key(27);
						else {
							var label = getDataset(target, "hii");
							if (!label) return;
							var keycode = Render.alt2hii(label);
							if (keycode) App.key(keycode);
							else if (keycode == 0) App.text(label);
						}
						break;
					case 3:
						if (key == 8) Render.sel2del(2);
						else if (key == 32) App.key(KEYCODE_UP);
						else App.key(KEYCODE_LEFT);
						break;
					case 4:
						if (key == 32) App.key(KEYCODE_DOWN);
						else App.key(KEYCODE_RIGHT);
						break;
					default:
						if (key == 32) {
							Render.alt2hii("â˜…");
							//					App.key(KEYCODE_STATE);
						} else {
							if (localStorage.ä¸Šæ»‘å¤§å†™ === 'true') {
								if (key >= 97 && key <= 122) {
									App.key(key - 32); return;
								}
							}
							var label = getDataset(target, "alt");
							if (!label) return;
							var keycode = Render.alt2hii(label);
							if (keycode) App.key(keycode);
							else if (keycode == 0) App.text(label);
						}
				}
			}

			function onMouseDown(evt) {
				evt.preventDefault();
				if (touchPresent)
					return;
				if (evt.button != 0)
					return;
				scroll = true;
				evt.preventDefault();
				touchedKeys[0] = { target: evt.target, x: 0, y: 0 };
				startPress(evt.target, evt, 0);
			}

			function onMouseUp(evt) {
				if (touchPresent)
					return;
				endPress(evt.target, evt, 0);
				touchedKeys[0] = undefined;
			}

			function onMouseMove(evt) {
				if (touchPresent)
					return;
				if (!touchedKeys[0])
					return;
				movePress(evt.target, evt, 0);
			}

			function onContextMenu(event) {
				event.preventDefault();
			}

			var eventHandlers = {
				touchstart: onTouchStart,
				mousedown: onMouseDown,
				mouseup: onMouseUp,
				mousemove: onMouseMove,
				contextmenu: onContextMenu
			};

			function init(keyboard) {
				_ime = $(keyboard);
				for (var event in eventHandlers)
					_ime.addEventListener(event, eventHandlers[event]);
			}

			return {
				init: init
			};
		})();

		var App = (function () {
			var debug = false;//navigator.userAgent.indexOf("Android")<=0;
			var initDone = false;
			function init() {
				console.log("yong:init");
				this.initDone = true;
			}
			function select(i, g) {
				if (g)
					console.log("yong:select " + i + " 1");
				else
					console.log("yong:select " + i);
			}
			function key(code) {
				console.log("yong:key " + code);
			}
			function text(t) {
				console.log("yong:text " + t);
			}
			function page() {
				console.log("yong:page");
			}
			function hide() {
				console.log("yong:hide");
			}
			function voice() {
				console.log("yong:voice");
			}
			function feedback() {
				console.log("yong:feedback");
			}
			function query(i) {
				console.log("yong:query " + i);
			}
			function action(type) {
				console.log("yong:action " + type);
			}
			function resize(w) {
				if (w > 0)
					w *= window.devicePixelRatio;
				console.log("yong:resize " + parseInt(w));
			}
			function cands() {
				console.log("yong:cands 1 100");
			}
			function onGetCandWords(cand, tip) {
				if (!cand) return;
				if (!my.ä¸‹æ‹‰è¡¥å…¨ç¼–ç ) overlay("cands", true, cand);
				else overlay("cands", true, cand, tip);
			}
			function onClipChanged(text) {
				if (!text || text.length > 5000)
					return;
				localStorage.firstclip = text;
				if (my.åæŸ¥å‰ªè´´æ¿å•å­— && text.length == 1 && text.match(Regex)) App.key(KEYCODE_FanCha);
				var arr;
				try {
					arr = JSON.parse(localStorage.clipboard);
				} catch (e) {
				}
				if (!Array.isArray(arr))
					arr = [];
				var time = Date.now();
				var i = arr.findIndex(e => e.text == text);
				if (i == 0 && Math.abs(time - arr[i].time) < 1000)
					return;
				if (i >= 0)
					arr.splice(i, 1);
				arr.unshift({ time, text });
				if (arr.length > 50)
					arr.pop();
				localStorage.clipboard = JSON.stringify(arr);
				var div = $('#keyboard-overlay.clipboard>div');
				if (div)
					updateClipboardDisplay(div);
			}
			function commit(t) {
				console.log("yong:commit " + t);
			}
			return {
				debug, init, initDone, select, key,
				text, page, hide, voice, feedback,
				query, action, resize, cands, onGetCandWords,
				onClipChanged, commit,
			};
		})();

		function init_keyboard() {
			filename = location.pathname.substring(location.pathname.lastIndexOf('/') + 1);
			if (filename == 'popup.html' || filename == 'cand.html') {
				Keyboards.english.key.length = 0;
				//		Tools.splice(1,Tools.length-2);
				Tools = [{ title: "ä¸´æ—¶è‹±æ–‡æ¨¡å¼", tool: " " }];
			}
			if (filename == 'keyboard_l.html')
				landscape = true;
			else if (location.search)
				landscape = (new URLSearchParams(location.search)).get('landscape') == 1;
			Render.init(".keyboard");
			Render.setKeyboard(Keyboards.english);

			Handler.init(".keyboard");
			App.init();
			window.addEventListener("resize", function () {
				if (window.innerWidth == Render.getWidth())
					return;
				$('.keyboard').style.setProperty("--keyboard-height", '0px');
				emoji(false);
				Render.draw();
			});
		}

		function getcss(ele, value) {
			if (!ele || !value) return;
			var element = $(ele);
			var style = window.getComputedStyle(element);
			var v = style.getPropertyValue(value);
			return v;
		}

		function theme(num) {
			if (!num || num == 0) num = "";
			num = "keyboard" + num + ".css";
			localStorage.é…è‰² = num;
			document.getElementById("theme_css").href = num;
			editor(false);
		}

		function emoji(show, on) {
			if (on) overlay("emoji", false);
			overlay("emoji", show);
		}

		function editor(show) {
			overlay("editor", show);
		}

		function editorGetShift() {
			var el = $('#keyboard-overlay button.select');
			if (el.classList.contains('selected')) return 0x020000;
			else return 0;
		}

		function setupTouchListeners(div, type) {
			var touch, touch1, index, txt, tt = false;
			if (localStorage.clipboard)
				txt = JSON.parse(localStorage.clipboard);
			div.addEventListener("touchstart", function (e) {
				touch = e.changedTouches.item(0);
				var actionTimeout, ele = e.target;
				if (ele.tagName == 'BUTTON' && type == "clipboard") {
					index = getDataset(ele, "index");
					actionTimeout = setTimeout(function () {
						Render.showMenu([{
							text: "ç½®é¡¶",
							click: function () {
								App.onClipChanged(txt[index].text);
								overlay(type, false); overlay(type, 0);
							}
						}, {
							text: "åˆ é™¤",
							click: function () {
								txt.splice(index, 1);
								localStorage.clipboard = JSON.stringify(txt);
								overlay(type, false); overlay(type, 0);
							}
						}
						]);
					}, 700);
				}
				var end = function () {
					if (actionTimeout) {
						clearTimeout(actionTimeout);
						actionTimeout = undefined;
					}
					ele.removeEventListener('touchend', end);
					ele.removeEventListener('touchmove', end);
				};
				ele.addEventListener('touchend', end);
				ele.addEventListener('touchmove', end);
			});
			div.addEventListener("touchend", function (e) {
				touch1 = e.changedTouches.item(0);
				if (touch1.clientX - touch.clientX > 250 && !tt) {
					if (type == "cands") App.key(27);
					overlay(type, false);
					if (type == "emoji") Render.showToolbar();
					tt = true;
				}
			});
			if (type == "setting") return;
			div.addEventListener("click", function (e) {
				var text = e.target.textContent;
				index = getDataset(e.target, "index");
				if (e.target.tagName != 'BUTTON' && !index) return;
				if (!text || text === "ã€€") return;
				switch (type) {
					case "theme": theme(index); break;
					case "cands": App.select(index, true); break;
					case "phrase": App.text(text.replace(/^\d+Â·/, '')); break;
					case "clipboard":
						App.text(txt[index].text);
						break;
					case "mymy":
					case "msgbox": App.text(text); break;
					case "emoji":
						App.text(text);
						if (localStorage.é” === 'false') {
							emoji(false);
							Render.showToolbar();
						} else return;
						break;
				}
				overlay(type, false);
			});
		}

		function updateClipboardDisplay(div) {
			div.innerHTML = '';
			var arr = [];
			try {
				arr = JSON.parse(localStorage.clipboard);
			} catch (e) {
			}

			if (!Array.isArray(arr) || arr.length == 0) {
				var p = document.createElement('p');
				p.textContent = 'å½“å‰æ²¡æœ‰å†…å®¹';
				div.appendChild(p);
				return;
			}
			for (var i = 0; i < arr.length; i++) {
				var p = arr[i];
				var d = new Date(p.time);
				var h = d.getHours().toString().padStart(2, 0);
				var m = d.getMinutes().toString().padStart(2, 0);
				var s = d.getSeconds().toString().padStart(2, 0);
				var time = `${h}:${m}:${s}`;
				var one = document.createElement('button');
				var span = document.createElement('span');
				span.textContent = time;
				one.appendChild(span);
				var textNode = document.createTextNode(p.text.substr(0, 50));
				one.appendChild(textNode);
				one.dataset.index = i;
				div.appendChild(one);
			}
		}

		function overlay(type, show, other0, other1) {
			var div = $("#keyboard-overlay");
			if (div) {
				var cur = getDataset(div, "show");
				document.body.removeChild(div);
				if (cur == show)
					return;
			}
			if (!type || show === false)
				return;
			var cand = $('.keyboard-candidate-panel').getBoundingClientRect();
			var border = $('.keyboard-border-inner').getBoundingClientRect();
			var keyboard = $('.keyboard');
			var width = keyboard.clientWidth;
			div = document.createElement('DIV');
			setDataset(div, "type", type);
			setDataset(div, "show", show);
			div.id = "keyboard-overlay";
			div.style.width = width + "px";
			var height;
			height = keyboard.clientHeight - cand.bottom;
			div.style.top = cand.bottom + "px";
			div.style.height = height + "px";

			var div2 = document.createElement('DIV');
			div2.style.width = '100%';

			div.appendChild(div2);

			addClass(div, "overlay");
			addClass(div, type);
			if (type == "emoji") {
				var emojis = [[
					"ğŸ˜€", "ğŸ˜", "ğŸ˜‚", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜…", "ğŸ˜†", "ğŸ˜‡", "ğŸ˜ˆ", "ğŸ˜‰",
					"ğŸ˜Š", "ğŸ˜‹", "ğŸ˜Œ", "ğŸ˜", "ğŸ˜", "ğŸ˜", "ğŸ˜", "ğŸ˜‘", "ğŸ˜’", "ğŸ˜“",
					"ğŸ˜”", "ğŸ˜•", "ğŸ˜–", "ğŸ˜—", "ğŸ˜˜", "ğŸ˜™", "ğŸ˜š", "ğŸ˜›", "ğŸ˜œ", "ğŸ˜",
					"ğŸ˜", "ğŸ˜Ÿ", "ğŸ˜ ", "ğŸ˜¡", "ğŸ˜¢", "ğŸ˜£", "ğŸ˜¤", "ğŸ˜¥", "ğŸ˜¦", "ğŸ˜§",
					"ğŸ˜¨", "ğŸ˜©", "ğŸ˜ª", "ğŸ˜«", "ğŸ˜¬", "ğŸ˜­", "ğŸ˜®", "ğŸ˜¯", "ğŸ˜°", "ğŸ˜±",
					"ğŸ˜²", "ğŸ˜³", "ğŸ˜´", "ğŸ˜µ", "ğŸ˜¶", "ğŸ˜·", "ğŸŒ", "âš½", "ğŸ€", "ğŸ†",
					"ğŸ”", "ğŸ‰", "ğŸ“", "ğŸ‘Œ", "ğŸ‘", "ğŸ™", "ğŸ™‚", "ğŸ™ƒ", "ğŸ™„", "ğŸ™…",
					"ğŸ‘", "ğŸš", "ğŸ™ˆ", "ğŸ™‰", "ğŸ™Š", "âš¡", "ğŸ™Œ", "ğŸ’Š", "â˜•", "ğŸ™",
					"ğŸŒš", "â¤", "ğŸ’”", "ğŸŒ¹", "ğŸ’£", "ğŸ·", "ğŸ¥", "ğŸ€", "ğŸ¶", "ğŸ‚",
					"ğŸ‘", "â›…", "â˜€", "â˜", "â˜", "â˜”", "âœŠ", "âœ‹", "âœŒ", "ğŸ’‹"
				], [
					"!", "@", "#", "$", "%", "^", "&", "*", "(", ")",
					"_", "-", "+", "=", "|", "\\", "[", "]", "{", "}",
					"`", "~", '"', "'", ":", ";", "/", "?", "<", ">",
					"1", "2", "3", "4", "5", "6", "7", "8", "9", "0",
					"q", "w", "e", "r", "t", "y", "u", "i", "o", "p",
					"a", "s", "d", "f", "g", "h", "j", "k", "l", "ã€€",
					"ã€€", "z", "x", "c", "v", "b", "n", "m", ",", ".",
					"Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P",
					"A", "S", "D", "F", "G", "H", "J", "K", "L", "ã€€",
					"ã€€", "Z", "X", "C", "V", "B", "N", "M", "ï¼Œ", "ã€‚"
				], [
					'â†‘', 'â†“', 'â†', 'â†’', 'â†–', 'â†—', 'â†˜', 'â†™', 'â†”', 'â†•',
					'â‡¦', 'â‡§', 'â‡¨', 'â‡©', 'ğŸ’¬', 'â¤¶', 'â†¶', 'â—', 'â ', 'â¬…',
					'â¬†', 'â¡', 'â¬‡',
					'â', 'âŒ¦', 'âœ‚', 'â', 'â', 'â–£', 'âœ“', 'âœ—', 'â–¼', 'â—',
					'â–²', 'â—†', 'â– ', 'â˜…', 'â–¶', 'â—€', 'â¤', 'ğŸ¤', 'ğŸ“·', 'ÏŸ',
					'Â©', 'Â®', 'â„—', 'âŒ«', 'â„¢', 'â„¡', 'â„»', 'â–³', 'â–½', 'âš™',
					'â˜†', 'ãŠ¤', 'ãŠ¥', 'ãŠ¦', 'ãŠ§', 'ãŠ¨', 'â˜˜', 'ğŸ‡¨ğŸ‡³', 'â˜š', 'â˜›',
					'â˜', 'âŒ¨', 'â˜»', 'â˜¹', 'âŒ¥ ', 'â™²', 'â˜¬', 'ğŸ«¥', 'ğŸ¨', 'â˜¯',
					'â™°', 'â˜¸', 'â™º', 'â™»', 'å', 'å', 'âœ¿', 'â¥', 'âš”', 'âš’',
					'â„ƒ', 'ğŸŒ€', 'â„‰', 'âš›', 'â›¬', 'âš', 'âš', 'âšŸ', 'âš ', 'â€',
					'â›¶', 'áƒ¦', 'âš¼', 'âœº', 'â˜©', 'ğŸ‘ï¸â€ğŸ—¨ï¸', 'â˜', 'â˜‘', 'â˜’', 'â˜“'
				], [
					'Ëœ', 'âº', 'â»', 'â¼', 'â½', 'â¾', 'á´¬', 'áµƒ', 'á´®', 'áµ‡',
					'á¶œ', 'á´°', 'áµˆ', 'á´±', 'áµ‰', 'á¶ ', 'á¶¡', 'á´³', 'áµ', 'á´´',
					'Ê°', 'á´µ', 'â±', 'á´¶', 'Ê²', 'á´·', 'áµ', 'á´¸', 'á¶«', 'á´¹',
					'áµ', 'á´º', 'â¿', 'á´¼', 'áµ’', 'á´¾', 'áµ–', 'á´¿', 'Ê³', 'Ë¢',
					'áµ€', 'áµ—', 'áµ', 'áµ˜', 'â±½', 'áµ‚', 'Ê·', 'Ë£', 'Ê¸', 'á¶»',
					'â°', 'Â¹', 'Â²', 'Â³', 'â´', 'âµ', 'â¶', 'â·', 'â¸', 'â¹',
					'â‚€', 'â‚', 'â‚‚', 'â‚ƒ', 'â‚„', 'â‚…', 'â‚†', 'â‚‡', 'â‚ˆ', 'â‚‰',
					"â‘ ", "â‘¡", "â‘¢", "â‘£", "â‘¤", "â‘¥", "â‘¦", "â‘§", "â‘¨", "â‘©",
					"â¶", "â·", "â¸", "â¹", "âº", "â»", "â¼", "â½", "â¾", "â¿",
					"â’ˆ", "â’‰", "â’Š", "â’‹", "â’Œ", "â’", "â’", "â’", "â’", "â’‘",
					"ğ€", "ğ", "ğ‚", "ğƒ", "ğ„", "ğ…", "ğ†", "ğ‡", "ğˆ", "ğ‰", "ğŠ", "ğ‹", "ğŒ", "ğ", "ğ", "ğ", "ğ", "ğ‘", "ğ’", "ğ“", "ğ”", "ğ•", "ğ–", "ğ—", "ğ˜", "ğ™"
				]];
				my.show = show;
				var c1 = emojis[show].length, H;
				if (height <= 550) H = height / 4; else H = height / 5;
				for (var i = 0; i < c1; i++) {
					var one = document.createElement("button");
					one.textContent = emojis[show][i];
					one.style.width = width / 10 + "px";
					one.style.height = H + "px";
					div2.appendChild(one);
				}
				Render.showToolbar(show);
				setupTouchListeners(div2, "emoji");
			} else if (type == "editor") {
				var actions = [[
					{
						text: "âŒ¨",
						left: "2.5%", top: "8%",
						click: function () { App.action("switchInputMethod"); }
					}, {
						text: "âŒ¦",
						left: "18.5%", top: "8%", repeat: true,
						click: function () { App.key(KEYCODE_DEL_F); }
					}, {
						text: "â†‘",
						left: "34.5%", top: "8%", repeat: true,
						click: function () { App.key(KEYCODE_UP | editorGetShift()); }
					}, {
						text: "âŒ«",
						left: "50.5%", top: "8%", repeat: true,
						click: function () { App.key(KEYCODE_DEL); }
					}, {
						text: "å…¨é€‰",
						left: "66.5%", top: "8%",
						click: function () { App.action("selectAll"); }
					}, {
						text: "åˆ è¡Œ",
						left: "82.5%", top: "8%",
						click: function () { Render.sel2del(true); App.key(255); }
					}, {
						text: "å·¦æ‰‹",
						left: "2.5%", top: "30%",
						click: function () { Render.changes(0); }
					}, {
						text: "â†",
						left: "18.5%", top: "30%", repeat: true,
						click: function () { App.key(KEYCODE_LEFT | editorGetShift()); }
					}, {
						text: "â˜©",
						left: "34.5%", top: "30%", select: true,
						click: function (el) {
							if (el.classList.contains('selected')) {
								el.classList.remove('selected');
							} else el.classList.add('selected');
						}
					}, {
						text: "â†’",
						left: "50.5%", top: "30%", repeat: true,
						click: function () { App.key(KEYCODE_RIGHT | editorGetShift()); }
					}, {
						text: "å¤åˆ¶",
						left: "66.5%", top: "30%",
						click: function () { App.action("copy"); }
					}, {
						text: "ğŸ¤",
						left: "82.5%", top: "30%",
						click: function () { App.voice(); }
					}, {
						text: "å³æ‰‹",
						left: "2.5%", top: "52%",
						click: function () { Render.changes(1); }
					}, {
						text: "Home",
						left: "18.5%", top: "52%",
						click: function () { App.key(KEYCODE_HOME | editorGetShift()); }
					}, {
						text: "â†“",
						left: "34.5%", top: "52%", repeat: true,
						click: function () { App.key(KEYCODE_DOWN | editorGetShift()); }
					}, {
						text: "End",
						left: "50.5%", top: "52%",
						click: function () { App.key(KEYCODE_END | editorGetShift()); }
					}, {
						text: "å‰ªåˆ‡",
						left: "66.5%", top: "52%",
						click: function () { App.action("cut"); }
					}, {
						text: "ğŸ“·",
						left: "82.5%", top: "52%",
						click: function () { App.action("qrcode"); editor(false); }
					}, {
						text: "ğŸ‘ï¸â€ğŸ—¨ï¸",
						left: "2.5%", top: "74%",
						click: function () { Render.hint(); editor(false); }
					}, {
						text: "Tab",
						left: "18.5%", top: "74%",
						click: function () { App.key(KEYCODE_TAB); }
					}, {
						text: "â£",
						left: "34.5%", top: "74%", repeat: true,
						click: function () { App.key(KEYCODE_SPACE); }
					}, {
						text: " â¤¶",
						left: "50.5%", top: "74%",
						click: function () { App.key(KEYCODE_ENTER); }
					}, {
						text: "ç²˜è´´",
						left: "66.5%", top: "74%",
						click: function () { App.action("paste"); }
					}, {
						text: "è¿”å›",
						left: "82.5%", top: "74%",
						click: function () { editor(false); }
					}
				]];
				div2.addEventListener('touchstart', function (e) {
					App.feedback();
					var ele = e.target;
					if (ele.tagName != 'BUTTON')
						return;
					var i = getDataset(ele, "action");
					var actionTimeout, actionInterval;
					if (actions[show][i].repeat) {
						actionTimeout = setTimeout(function () {
							actionTimeout = undefined;
							actions[show][i].click();
							actionInterval = setInterval(function () {
								actions[show][i].click();
							}, REPEAT_RATE);
						}, REPEAT_TIMEOUT);
					}
					var end = function () {
						if (actionTimeout) {
							clearTimeout(actionTimeout);
							actions[show][i].click(ele);
							actionTimeout = undefined;
						} else if (actionInterval) {
							clearInterval(actionInterval);
							actionInterval = undefined;
						} else {
							actions[show][i].click(ele);
						}
						ele.removeEventListener('touchend', end);
						ele.removeEventListener('touchcancel', end);
					};
					ele.addEventListener('touchend', end);
					ele.addEventListener('touchcancel', end);
				});
				for (var i = 0; i < actions[show].length; i++) {
					var one = document.createElement('button');
					one.textContent = actions[show][i].text;
					if (actions[show][i].select)
						addClass(one, "select")
					else if (actions[show][i].repeat || actions[show][i].text.length == 1)
						addClass(one, "arrow");
					one.style.left = actions[show][i].left;
					one.style.top = actions[show][i].top;
					setDataset(one, "action", i);
					div2.appendChild(one);
				}
			} else if (type == "mymy") {
				var L = [
					["â“ª", "â‘ ", "â‘¡", "â‘¢", "â‘£", "â‘¤", "â‘¥", "â‘¦", "â‘§", "â‘¨", "â‘©", "â‘ª", "â‘«", "â‘¬", "â‘­", "â‘®", "â‘¯", "â‘°", "â‘±", "â‘²", "â‘³", "ã‰‘", "ã‰’", "ã‰“", "ã‰”", "ã‰•", "ã‰–", "ã‰—", "ã‰˜", "ã‰™", "ã‰š", "ã‰›", "ã‰œ", "ã‰", "ã‰", "ã‰Ÿ", "ãŠ±", "ãŠ²", "ãŠ³", "ãŠ´", "ãŠµ", "ãŠ¶", "ãŠ·", "ãŠ¸", "ãŠ¹", "ãŠº", "ãŠ»", "ãŠ¼", "ãŠ½", "ãŠ¾", "ãŠ¿",
						"ï¼¡", "ï¼¢", "ï¼£", "ï¼¤", "ï¼¥", "ï¼¦", "ï¼§", "ï¼¨", "ï¼©", "ï¼ª", "ï¼«", "ï¼¬", "ï¼­", "ï¼®", "ï¼¯", "ï¼°", "ï¼±", "ï¼²", "ï¼³", "ï¼´", "ï¼µ", "ï¼¶", "ï¼·", "ï¼¸", "ï¼¹", "ï¼º"
					],
					["@qq.com", "@163.com", "@gmail.com", "@outlook.com",
						"http://", "https://", "file://"
					]
				];
				for (var i = 0; i < L[show].length; i++) {
					var one = document.createElement("div");
					one.textContent = L[show][i];
					one.dataset.index = i;
					div2.style.width = '99%';
					div2.appendChild(one);
				}
				setupTouchListeners(div2, "mymy");
			} else if (type == "theme") {
				var L = my.é…è‰².length, T = localStorage.é…è‰²;
				if (T == "keyboard.css") T = "keyboard0.css";
				if (height <= 550) H = height / 5; else H = 96;
				for (var i = 0; i < L; i++) {
					var one = document.createElement("button");
					one.textContent = my.é…è‰²[i];
					one.style.width = width * .945 / 6 + "px";
					one.style.height = H + "px";
					if (T === 'keyboard' + i + ".css") {
						one.style.background = "pink";
						one.style.color = "black";
					}
					one.dataset.index = i;
					div2.appendChild(one);
				}
				setupTouchListeners(div2, "theme");
			} else if (type == "msgbox") {
				if (localStorage.getItem('message') === null) { alert('æ²¡æœ‰å†…å®¹'); overlay("msgbox", false); return; }
				var one = document.createElement('button');
				one.textContent = localStorage.message;
				div2.appendChild(one);
				setupTouchListeners(div2, "msgbox");
			} else if (type == "cands") {
				for (var i = 0; i < other0.length; i++) {
					var one = document.createElement('div');
					var two = document.createElement('span');
					two.textContent = other0[i];
					var txt = "", link = document.createElement('a');
					if (other1 && other1[i]) {
						for (let char of other1[i]) {
							var txtcode = char.charCodeAt(0);
							if (txtcode >= 97 && txtcode <= 122)
								txt += String.fromCodePoint(119737 + txtcode);
							else txt += char;
						}
					}
					link.textContent = txt;
					two.appendChild(link);
					one.dataset.index = i + 1;
					one.appendChild(two);
					div2.style.width = '99%';
					div2.appendChild(one);
				}
				setupTouchListeners(div2, "cands");
			} else if (type == "clipboard") {
				updateClipboardDisplay(div2);
				setupTouchListeners(div2, "clipboard");
			} else if (type == "phrase") {
				loadtext(my.çŸ­è¯­)
					.then(data => {
						my.çŸ­è¯­ = data;
						var P1 = my.çŸ­è¯­.length;
						if (P1 > 50) P1 = my.çŸ­è¯­.length = 50;
						for (var i = 0; i < P1; i++) {
							var one = document.createElement("button");
							one.textContent = i + 1 + 'Â·' + my.çŸ­è¯­[i];
							one.style.width = "99%";
							div2.appendChild(one);
						}
						setupTouchListeners(div2, "phrase");
					});
			} else if (type == "setting") {
				var è®¾ç½® = [
					"â“ªæ˜¾ç¤ºæ•°å­—è¡Œ",
					"â‘ æ˜¾ç¤ºå·¥å…·æ ",
					"â‘¡éšè—ä¸Šä¸‹æ ‡",
					"â‘¢ä¸Šæ»‘è¾“å‡ºå¤§å†™",
					"â‘£æ˜¾ç¤ºå€™é€‰åºå·",
					"â‘¤æ˜¾ç¤ºé€‰é‡é”®",
					"â‘¥æ‚¬æµ®æ ç«–å‘",
					"â‘¦ç©ºæ ¼æ˜¾ç¤ºè¾“å…¥æ³•",
					"â‘§å€™é€‰æ å·¥å…·1/2",
					"â‘¨âŒ¨é»˜è®¤26é”®",
					"â‘©âŒ¨åå››é”®",
					"â‘ªâŒ¨åä¸ƒé”®",
					"â‘«âŒ¨å°é¹¤åŠ©è®°",
					"â‘¬âŒ¨æœ‰/æ–œæ é”®",
					"â‘­âŒ¨å¤§ç©ºæ ¼é”®",
					"â‘®âŒ¨æŸ¯å°”å…‹å­œæ—è¯­",
					"â‘¯é‡è½½çŸ­è¯­æ–‡ä»¶",
					"â‘°é•¿æŒ‰å¤§å†™",
					"â‘±è°ƒç”¨å¤§å­—é›†å­—ä½“",
					"ã€€",
					"ã€€",
					"ã€€",
					"âš çš®è‚¤è®¾ç½®åˆå§‹åŒ–",
					"è¿”å›"
				];
				var C = ["æ•°å­—è¡Œ", "å·¥å…·æ ", "æ¸…çˆ½", "ä¸Šæ»‘å¤§å†™", "å€™ç¼–å·", "é€‰é‡é”®", "å‚ç›´æ‚¬æµ®æ ", "ç©ºæ ¼æ˜¾ç¤º", "å€™å·¥å…·", "é»˜è®¤", "14é”®", "17é”®", "å°é¹¤åŠ©è®°", "æ— åˆ†å·", "å¤§ç©ºæ ¼", "å¸ƒå±€2", "é‡è½½çŸ­è¯­", "é•¿æŒ‰å¤§å†™", "å­—ä½“"];
				var L = è®¾ç½®.length;
				for (var i = 0; i < L; i++) {
					var one = document.createElement("button");
					one.textContent = è®¾ç½®[i];
					one.style.height = height / 5 + "px";
					if (localStorage[C[i]] === 'true') {
						one.style.background = "pink";
						one.style.color = "black";
					}
					if (C[i] === Keyboards.english.name) {
						one.style.background = "#bff";
						one.style.color = "black";
					}
					div2.appendChild(one);
				}
				setupTouchListeners(div2, "setting");
				div2.addEventListener("touchstart", App.feedback);
				div2.addEventListener("click", function (e) {
					var text = e.target.textContent;
					switch (text) {
						case !text:
						case "ã€€": return; break;
						case è®¾ç½®[0]:
							editor(false);
							var v = getcss('.keyboard-key[data-row="0"]', "display");
							if (v != 'none') docE.setProperty('--æ•°å­—æ ', 'none');
							else docE.setProperty('--æ•°å­—æ ', 'inline-block');
							localStorage.æ•°å­—è¡Œ = !JSON.parse(localStorage.æ•°å­—è¡Œ);
							break;
						case è®¾ç½®[1]:
							var value = getcss(".keyboard .adds", "display");
							if (value != 'none') docE.setProperty('--å·¥å…·æ ', 'none');
							else docE.setProperty('--å·¥å…·æ ', 'flex');
							localStorage.å·¥å…·æ  = !JSON.parse(localStorage.å·¥å…·æ );
							Render.draw();
							break;
						case è®¾ç½®[2]:
							var temp = !JSON.parse(localStorage.æ¸…çˆ½);
							localStorage.æ¸…çˆ½ = temp;
							Render.alt2hii("çˆ½"); break;
						case è®¾ç½®[3]:
							var temp = !JSON.parse(localStorage.ä¸Šæ»‘å¤§å†™);
							localStorage.ä¸Šæ»‘å¤§å†™ = temp;
							alert("ä¸Šæ»‘è¾“å‡º " + (temp ? "å¤§å†™" : "ä¸Šæ ‡"));
							break;
						case è®¾ç½®[4]: Render.alt2hii("ç¼–"); break;
						case è®¾ç½®[5]: Render.alt2hii("é‡"); break;
						case è®¾ç½®[6]: Render.alt2hii("æ‚¬"); break;
						case è®¾ç½®[7]:
							Render.alt2hii("æ˜¾");
							getLayout(parseInt(localStorage.getItem('å¸ƒå±€')), true);
							Render.draw();
							break;
						case è®¾ç½®[8]:
							my.tool = !my.tool;
							Render.showCandidates([], 0, false);
							break;
						case è®¾ç½®[9]: getLayout(0, true); break;
						case è®¾ç½®[10]: getLayout(2, true); break;
						case è®¾ç½®[11]: getLayout(3, true); break;
						case è®¾ç½®[12]: getLayout(4, true); break;
						case è®¾ç½®[13]: getLayout(1, true); break;
						case è®¾ç½®[14]: getLayout(5, true); break;
						case è®¾ç½®[15]: getLayout(6, true); break;
						case è®¾ç½®[16]:
							my.çŸ­è¯­.length = 0;
							var temp2 = 1;
							break;
						case è®¾ç½®[17]:
							var temp = !JSON.parse(localStorage.é•¿æŒ‰å¤§å†™);
							localStorage.é•¿æŒ‰å¤§å†™ = temp;
							alert("é•¿æŒ‰å¤§å†™ å·²" + (temp ? "å¼€å¯" : "å…³é—­"));
							break;
						case è®¾ç½®[18]:
							var temp = !JSON.parse(localStorage.å­—ä½“) || false;
							localStorage.å­—ä½“ = temp;
							alert("å¤§å­—é›† å·²" + (temp ? "å¼€å¯" : "å…³é—­"));
							if (temp) {
								docE.setProperty('--å€™é€‰æ å­—ä½“', '600 var(--å€™å­—ä½“å¤§å°) æ±‰å­—å­—ä½“,sans-serif,å¤§å­—é›†');
								docE.setProperty('--ç•Œé¢å­—ä½“', 'var(--ç•Œé¢å­—ä½“å¤§å°) æ±‰å­—å­—ä½“,sans-serif,å¤§å­—é›†');
							} else {
								docE.setProperty('--ç•Œé¢å­—ä½“', 'var(--ç•Œé¢å­—ä½“å¤§å°) æ±‰å­—å­—ä½“,sans-serif');
								docE.setProperty('--å€™é€‰æ å­—ä½“', "600 var(--å€™å­—ä½“å¤§å°) æ±‰å­—å­—ä½“,sans-serif");
							}
							break;
						case è®¾ç½®[L - 2]:
							localStorage.clear();
							alert('å·²æ¢å¤è¿™ä¸ªçš®è‚¤çš„åˆå§‹è®¾ç½®,é‡è½½çš®è‚¤åç”Ÿæ•ˆ.');
							break;
						case è®¾ç½®[L - 1]: break;
						default: return; break;
					}
					overlay("setting", false);
					if (temp2) overlay("phrase", 0);
				});
			}
			document.body.appendChild(div);
			div.addEventListener('contextmenu', function (e) {
				e.preventDefault();
			});
		}
		// è…¾è®¯ç¿»è¯‘:
		async function translateText(text) {
			var from, to, url = "https://transmart.qq.com/api/imt";
			if (text.match(Regex)) { from = 'zh'; to = 'en'; }
			else { from = 'en'; to = 'zh'; }
			var data = {
				header: {
					fn: "auto_translation", session: "",
					client_key: "browser-edge-chromium-118.0.0-Windows 10-f9ee2d26-6fef-458e-8053-55251b67bb14-1693640131209", user: ""
				},
				type: "plain", model_category: "normal", text_domain: "general", credentials: "include",
				source: { lang: from, text_list: [text] }, target: { lang: to }
			};
			var response = await fetch(url, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json; charset=utf-8'
				},
				body: JSON.stringify(data)
			});
			var result = await response.json();
			return result.auto_translation[0];
		}
		// å¤©æ°” & ç®€æŠ¥ & å­—å…¸
		async function jianbao(url) {
			var response = await fetch(url, {
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded'
				},
				method: "GET",
			});
			var data = await response.json();
			return data;
		}
		// è¯»å–çŸ­è¯­æ–‡ä»¶,è·¯å¾„: /yong/.yong/android/phrase.txt
		async function loadtext(txt) {
			if (txt[0]) return txt;
			var text;
			try {
				text = await (await fetch("../phrase.txt")).text();
				if (!text) return null;
			} catch (e) { text = ''; }
			var arr = text.split('\n').map(e => e.trim()); //e.trim() ä¼šåˆ é™¤å‰åç©ºæ ¼å’Œtabç¬¦å·
			return arr;
		}
		/*è¯»å–yong.inié…ç½®æ–‡ä»¶*/
		async function iniGet(G, K) {
			var text, config = null;
			try {
				text = await (await fetch("http://yong.dgod.net/config/yong.ini")).text();
				if (!text)
					return null;
			} catch (e) {
				console.log(e);
				text = '';
			}
			var arr = text.split('\n').map(e => e.trim());
			var config = {};
			var cur = null;
			for (var i = 0; i < arr.length; i++) {
				var line = arr[i];
				if (!line || line[0] == '#')
					continue;
				if (line[0] == '[') {
					var grp = line.substring(1, line.length - 1);
					if (!config[grp])
						config[grp] = {};
					cur = config[grp];
					continue;
				}
				if (!cur)
					continue;
				var j = line.indexOf('=');
				if (j <= 0)
					continue;
				var key = line.substring(0, j).trim();
				var val = line.substring(j + 1).trim();
				cur[key] = val;
			}
			return config[G][K];
		}
		/* ä¿®æ”¹yong.inié…ç½®æ–‡ä»¶*/
		function iniSet(group, key, val) {
			console.log(`yong:config set ${group} ${key} ${val}`);
			console.log("yong:config save");
		}
		/* åº•éƒ¨æ˜¾ç¤º å†œå†/æ–‡æœ¬ */
		function bottomText(on, num) {
			if (num == 1) {
				var toCnDate = date => date.toLocaleDateString('zh-u-ca-chinese', { dateStyle: 'full' }) + ' ' + date.toLocaleDateString();
				var å±ç›¸ = ["é¼ ", "ç‰›", "è™", "å…”", "é¾™", "è›‡", "é©¬", "ç¾Š", "çŒ´", "é¸¡", "ç‹—", "çŒª"];
				var å¹´ä»½ = new Date().getFullYear();
				var ç”Ÿè‚– = å±ç›¸[(å¹´ä»½ - 4) % 12];
				var text = "(" + ç”Ÿè‚– + ")" + toCnDate(new Date);
			} else if (num == 2) {
				/*var éšæœº = [
					"è½å¶é£èŠ±", "æ¸…é£æ˜æœˆ", "ç‹¬é’“å¯’æ±Ÿé›ª", "å¤§é“è‡³ç®€", "ç¬‘çœ‹é£äº‘", "æ˜¥æš–èŠ±å¼€"
				];*/
				var éšæœº = [
					"ä¸­/En"
				];
				var num = Math.floor(Math.random() * éšæœº.length);
				var text = éšæœº[num];
			}
			if (on) $('.bottom-zg span').textContent = text;
			my.æ–‡æœ¬ = text;
		}
	</script>
</head>

<body onload="init_keyboard();">
	<div class="keyboard">
	</div>
	<div class="action-shadow">
		<div class="action-center">
			<div class="action-menu"></div>
		</div>
	</div>
</body>

</html>